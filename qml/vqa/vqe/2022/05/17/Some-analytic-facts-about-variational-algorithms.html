<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Some analytic facts about variational quantum algorithms | Notes on &lt; Quantum Computing &gt;</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Some analytic facts about variational quantum algorithms" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Parameter-shift rule, sequential optimization, average performance – it’s mostly basic trigonometry, really." />
<meta property="og:description" content="Parameter-shift rule, sequential optimization, average performance – it’s mostly basic trigonometry, really." />
<link rel="canonical" href="https://idnm.github.io/blog/blog/qml/vqa/vqe/2022/05/17/Some-analytic-facts-about-variational-algorithms.html" />
<meta property="og:url" content="https://idnm.github.io/blog/blog/qml/vqa/vqe/2022/05/17/Some-analytic-facts-about-variational-algorithms.html" />
<meta property="og:site_name" content="Notes on &lt; Quantum Computing &gt;" />
<meta property="og:image" content="https://idnm.github.io/blog/blog/images/slide.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-17T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://idnm.github.io/blog/blog/qml/vqa/vqe/2022/05/17/Some-analytic-facts-about-variational-algorithms.html","@type":"BlogPosting","headline":"Some analytic facts about variational quantum algorithms","dateModified":"2022-05-17T00:00:00-05:00","datePublished":"2022-05-17T00:00:00-05:00","image":"https://idnm.github.io/blog/blog/images/slide.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://idnm.github.io/blog/blog/qml/vqa/vqe/2022/05/17/Some-analytic-facts-about-variational-algorithms.html"},"description":"Parameter-shift rule, sequential optimization, average performance – it’s mostly basic trigonometry, really.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://idnm.github.io/blog/blog/feed.xml" title="Notes on &lt; Quantum | Computing &gt;" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1154MLY31V"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1154MLY31V');
</script>


<link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
<meta name="google-site-verification" content="PavVqGD_DmVWpwhYbxaxic6hZ-SgRkZIu6MKjzrGJC8" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Notes on &lt; Quantum | Computing &gt;</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Some analytic facts about variational quantum algorithms</h1><p class="page-description">Parameter-shift rule, sequential optimization, average performance -- it's mostly basic trigonometry, really.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-05-17T00:00:00-05:00" itemprop="datePublished">
        May 17, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      15 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#QML">QML</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#VQA">VQA</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#VQE">VQE</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/idnm/blog/tree/master/_notebooks/2022-05-17-Some analytic facts about variational algorithms.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          <div class="px-2">
    <a href="https://colab.research.google.com/github/idnm/blog/blob/master/_notebooks/2022-05-17-Some analytic facts about variational algorithms.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Introduction">Introduction </a></li>
<li class="toc-entry toc-h1"><a href="#Hi-$\cos$,-hi-$\sin$!">Hi $\cos$, hi $\sin$! </a></li>
<li class="toc-entry toc-h1"><a href="#A-typical-loss-function">A typical loss function </a></li>
<li class="toc-entry toc-h1"><a href="#Parameter-shift-rule">Parameter shift rule </a></li>
<li class="toc-entry toc-h1"><a href="#Sequential-optimization">Sequential optimization </a></li>
<li class="toc-entry toc-h1"><a href="#Average-performance-of-the-VQE">Average performance of the VQE </a></li>
<li class="toc-entry toc-h1"><a href="#Loss-landscape-as-charge-density">Loss landscape as charge density </a></li>
<li class="toc-entry toc-h1"><a href="#Beyond-simple-trigonometry">Beyond simple trigonometry </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-05-17-Some analytic facts about variational algorithms.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit</span> <span class="kn">import</span> <span class="n">Parameter</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Introduction">
<a class="anchor" href="#Introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction<a class="anchor-link" href="#Introduction"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Variational quantum algorithms (VQA) is a huge field by now with many prospective applications and a poll of advocates for their potential quantum advantage on the NISQ devices, see e.g. <a href="https://arxiv.org/abs/2012.09265">here</a> for a recent review. I usually think of variational quantum algorithms as analogues of the neural networks with a parametrized quantum circuit playing the role of a trainable model. Here is an example of a parametrized quantum circuit:</p>
<p><figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/analytic_vqe/pqc.png" alt="Drawing">
    
    
</figure>
</p>
<p>Despite certain similarities there are also crucial distinctions between the classical and quantum nets, manifesting both in their functional shapes and trainability properties. Here I will mostly talk about some functional properties of parametrized quantum circuits, and briefly touch on the trainability issues at the end. 
A whole slew of additional peculiarities arise when you want to run quantum circuits on real quantum hardware and have to deal with errors and stochastic nature of measurements. Here I will ignore these issues completely, effectively assuming that we can run a classical simulation of the quantum circuit.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Hi-$\cos$,-hi-$\sin$!">
<a class="anchor" href="#Hi-%24%5Ccos%24,-hi-%24%5Csin%24!" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hi $\cos$, hi $\sin$!<a class="anchor-link" href="#Hi-%24%5Ccos%24,-hi-%24%5Csin%24!"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For a generic neural net the loss function is a highly non-linear function of each weight, due to non-linear activation functions that connect the layers. In contrast, dependence of the parametrized quantum circuits on each single parameter separately is extremely simple.</p>
<p>I will denote the unitary matrix of a parametrized quantum circuit by $U(\theta)$, with $\theta$ standing for all the parameters collectively. A simple observation, and really the basis for all of the following discussion, is the following equation
\begin{align}
U(\theta_i)=U_0 \cos \frac{\theta_i}{2}+U_1\sin\frac{\theta_i}{2} \label{u cos sin} \ .
\end{align}
Here $\theta_i$ stands for any parameter of the circuit, other are assumed to be fixed. Matrix coefficients $U_0$ and $U_1$ are given by $U_0=U(0)$ and $U_1 = U(\pi)$. Relation \eqref{u cos sin} follows from the simple fact that all gates typically considered in VQA are of the form 
\begin{align*}
G(\theta) = e^{-i\theta \Sigma /2}
\end{align*}
with a generator $\Sigma$ that satisfies $\Sigma^2=1$. Hence, by a generalization of Euler's formula $e^{i\phi}=\cos \phi+i\sin\phi$ any gate can be alternatively written as 
\begin{align*}
G(\theta) = \cos \frac{\theta}{2}-i\Sigma\sin\frac{\theta}{2} \ .
\end{align*}
As an example one take any single-qubit Pauli rotation <a href="https://qiskit.org/documentation/stubs/qiskit.circuit.library.RXGate.html">ref</a>, say $R_X(\theta)=e^{-i \theta X/2}=\cos \frac{\theta}{2}-iX\sin\frac{\theta}{2}$. Parametric two-qubit gates, e.g. <a href="https://qiskit.org/documentation/stubs/qiskit.circuit.library.RZXGate.html">$R_{ZX}$ gate</a>, usually conform to the same rule. Because of the trigonometric function here the parameters in VQA are often referred to as <em>angles</em>, the terminology which I will follow.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="A-typical-loss-function">
<a class="anchor" href="#A-typical-loss-function" aria-hidden="true"><span class="octicon octicon-link"></span></a>A typical loss function<a class="anchor-link" href="#A-typical-loss-function"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A subset of the VQA are variational quantum eigensolvers (VQE). A typical loss function in VQE is <em>quadratic</em> in $U(\theta)$. For instance, one common goal in VQE is to prepare the ground state of some Hamiltonian $H$ using an ansatz $|\psi(\theta)\rangle = U(\theta)|0\rangle$. The relevant cost function to be minimized is</p>
\begin{align}
L(\theta)=\langle\psi(\theta)|H|\psi(\theta)\rangle \label{loss VQE} \ .
\end{align}<p>In the unitary synthesis problem, <a href="https://arxiv.org/abs/2205.01121">that I've been recently interested in</a>, the goal is to make the circuit $U(\theta)$ equivalent to some target unitary $V$. The relevant loss can be defined as</p>
\begin{align*}
L(\theta)=-|\operatorname{Tr} V^\dagger U(\theta)|^2
\end{align*}<p>You got the idea. Note that while the circuit $U(\theta)$ has only two terms \eqref{u cos sin} as a function of any angle $\theta_i$, the quadratic loss function will have three terms (note also the period doubling)</p>
\begin{align*}
L(\theta_i)=A \cos\theta_i+B \sin \theta_i + C \ .
\end{align*}<p>Here $A, B, C$ are functions of all the other angles except for $\theta_i$. They are the only unknowns that specify dependence on any particular angle and can be found with just three evaluations of the loss function, e.g.</p>
\begin{align*}
A+B = L(0),\qquad A+C=L(\pi/2),\qquad A-C = L(-\pi/2) \Rightarrow\\
A = \frac{L(\pi/2)+L(-\pi/2)}{2},\qquad C=\frac{L(\pi/2)-L(-\pi/2)}{2},\qquad B = L(0)-A \ .
\end{align*}
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Parameter-shift-rule">
<a class="anchor" href="#Parameter-shift-rule" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameter shift rule<a class="anchor-link" href="#Parameter-shift-rule"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Perhaps the best known consequence of this property is the parameter shift rule for derivatives. First, a bit of a background. Let's assume we need to estimate the derivative of some function $f(x)$ that we only have numerical access to. Then, there is nothing much better one can do than to use the finite difference approximations. For example, using two function evaluations it is possible to compute the first derivative up to the second approximation order</p>
\begin{align*}
f'(x)=\frac{f(x+\epsilon)-f(x-\epsilon)}{2\epsilon}+O(\epsilon^2)
\end{align*}<p>In general, adding one more evaluation point allows to improve the accuracy by one order. However, when you have additional knowledge about the function much more efficient strategy may exists. In particular, for VQE loss functions \eqref{loss VQE} an <em>exact</em> derivative computation is possible with just two function evaluations</p>
\begin{align*}
L'(\theta_i)=-A \sin(\theta_i)+B\cos{\theta_i}=\frac{L(\theta_i+\pi/2)-L(\theta_i-\pi/2)}{2} \ ,
\end{align*}<p>which follows from $\sin(x+\pi/2)=\cos x,\,\,\cos(x+\pi/2)=-\sin x$. Having access to exact derivatives generally enhances the performance of the gradient-based optimizers.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Sequential-optimization">
<a class="anchor" href="#Sequential-optimization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sequential optimization<a class="anchor-link" href="#Sequential-optimization"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>An interesting extension of this idea, that is apparently much less known than the parameter-shift rule itself, was proposed in <a href="http://arxiv.org/abs/1903.12166">http://arxiv.org/abs/1903.12166</a> (I believe there another independent paper introducing the same method, but I can't find it now). Instead of using structural properties of \eqref{loss VQE} to just compute derivatives, one can find the exact minimum of $L(\theta_i)$ with respect to any angle $\theta_i$ (assuming other angles are fixed). I.e. instead of a partial derivative one can compute "the partial minimum".</p>
<p>Indeed, since just three three evaluations fix $L(\theta_i)$ completely, and the function itself is rather simple, there is no problem finding $\operatorname{argmin}_{\theta_i}L(\theta_i)$ exactly. The explicit formula could be more transparent, but it is a simple trigonometry in the end (double check if you a going to use it!)</p>
\begin{align*}
\theta^*=\operatorname{argmin}_{\theta}\left(A \cos\theta+B\sin\theta+C\right)=\cases{\arctan \frac{B}{A}+\pi,&amp;A&gt;0\\\arctan \frac{B}{A},&amp; A&lt;0}
\end{align*}<p>With this trick one can bypass gradient-based optimization as follows. Starting from $L(\theta_1,\theta_2,\dots)$ first optimize with respect to the first angle $L(\theta_1,\theta_2,\dots)\to L(\theta_1^*,\theta_2,\dots)$. Then optimize with respect to the second $L(\theta_1^*,\theta_2,\dots)\to L(\theta_1^*,\theta_2^*,\dots)$. Note that after this step the first angle in general no longer is the best choice, because the second angle has changed. Still, one can continue this procedure further until all angles are updated and then start anew. Each step is guaranteed to decrease the value of the loss function. If the loss landscape is nice overall, this sequential gradient-free optimization may in fact even outperform gradient-based methods. Unfortunately, to my understanding the sequential optimization is unlikely to help with the most crucial problems in the VQE loss landscapes: barren plateaus and local minimums.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Average-performance-of-the-VQE">
<a class="anchor" href="#Average-performance-of-the-VQE" aria-hidden="true"><span class="octicon octicon-link"></span></a>Average performance of the VQE<a class="anchor-link" href="#Average-performance-of-the-VQE"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here comes the original contribution of this blog post, I will show how to compute (semi-efficiently) the <em>average loss</em> 
\begin{align}
\overline{L}=\frac{1}{(2\pi)^p}\int \prod_{i=1}^p d\theta_i \langle \psi(\theta)|H|\psi(\theta)\rangle \ .
\end{align}
where $p$ is the total number of angles in the parametrized circuit. Why would one be interested in such a quantity? Honestly, I do not know, but hey, this is a blog post and not a paper, so I'll take a recreational attitude. Seriously though, I'll use this result in the following section, which however is not well justified either:)</p>
<p>To begin with, let's make explicit dependence of the parametrized circuit on all of its angles
\begin{align}
U(\theta)=\sum_{I} U_{I}\left(\cos\frac{\theta}{2}\right)^{1-I}\left(\sin\frac{\theta}{2}\right)^I \label{u exp} \ .
\end{align}
Here $I$ is a multi-index, a binary string of length $p$, and $\left(\cos\frac{\theta}{2}\right)^{I}$ is an abbreviation for $\prod_{i=1}^p\left(\cos \frac{\theta_i}{2}\right)^{I_i}$. For $p=1$ this reduces to \eqref{u cos sin}. For $p=2$ we have
\begin{align*}
U(\theta)=U_{00}\cos\frac{\theta_1}{2}\cos\frac{\theta_2}{2}+U_{01}\cos\frac{\theta_1}{2}\sin\frac{\theta_2}{2}+U_{10}\sin\frac{\theta_1}{2}\cos\frac{\theta_2}{2}+U_{11}\sin\frac{\theta_1}{2}\sin\frac{\theta_2}{2} \ ,
\end{align*}
I think you got the idea. There are exactly $2^p$ terms in this sum. Now let us substitute this expression into the loss function \eqref{loss VQE}</p>
\begin{align}
L(\theta)=\sum_{I,J}\left(\cos\frac{\theta}{2}\right)^{1-I}\left(\sin\frac{\theta}{2}\right)^I\left(\cos\frac{\theta}{2}\right)^{1-J}\left(\sin\frac{\theta}{2}\right)^J\langle 0|U_I^\dagger  H U_J |0\rangle \label{loss exp} \ .
\end{align}<p>When we average, all terms with $I\neq J$ vanish since $\int_0^{2\pi} d\theta \sin\frac{\theta}{2}\cos\frac{\theta}{2}=0$. At the same time, all terms with $I=J$ give equal angle integrals $\frac{1}{(2\pi)^p}\int \prod_{i=1}^p d\theta_i \left(\cos\frac{\theta_i}{2}\right)^{2 I}\left(\sin\frac{\theta_i}{2}\right)^{2-2 I}=\frac{1}{2^p}$ since $\int d\theta \cos^2\frac{\theta}{2}=\int d\theta \sin^2\frac{\theta}{2}=\pi$. The results is that
\begin{align}
\overline{L}=\frac1{2^p}\sum_{I}\langle 0|U_I^\dagger H U_I |0\rangle \label{L average} \ .
\end{align}
This expression looks simple, but it is a sum with $2^p$ terms, so for any reasonable number of parameters its huuuge. A typical number of parameters is exponential in the number of qubits, so this is the double exponential, not good. I've spent multiple hours thinking about how to compute this average more efficiently, but for generic function of the type \eqref{u exp} with arbitrary matrix coefficients $U_I$ I didn't find a way to compute the average loss in less than an exponential in $p$ number of function calls. However, taking into account that $U_I$ are not arbitrary for parametrized quantum circuits, a computation linear in $p$ is possible. The reason is that among exponentially many $U_I$ there is only polynomially many "independent ones", in a sense that I will now make precise.</p>
<p>For concreteness consider the following toy circuit:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cz</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">Parameter</span><span class="p">(</span><span class="s1">'$ </span><span class="se">\\</span><span class="s1">theta_1 $'</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">Parameter</span><span class="p">(</span><span class="s1">'$ </span><span class="se">\\</span><span class="s1">theta_2 $'</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">Parameter</span><span class="p">(</span><span class="s1">'$ </span><span class="se">\\</span><span class="s1">theta_3 $'</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">Parameter</span><span class="p">(</span><span class="s1">'$ </span><span class="se">\\</span><span class="s1">theta_4 $'</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">'mpl'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here the entangling gate is the <a href="https://qiskit.org/documentation/stubs/qiskit.circuit.library.CZGate.html">Controlled-Z</a>. This circuit has four parameters and $2^4=16$ associated matrix coefficients $U_I$. What are they, exactly? It is in fact rather simple to understand. If the binary index is $0$ the rotation gate is replaced by the identity, if it is $1$ we insert the generator instead. For example $U_{1110}$ is</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cz</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">global_phase</span><span class="o">=</span><span class="n">pi</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">'mpl'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The global phase arises because $U(\theta=\pi)=-i \Sigma$ for $U(\theta)=e^{-i\theta\Sigma/2}$. Next, consider a more realistic circuit like the one below</p>
<p><figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/analytic_vqe/pqc_cz.png" alt="Drawing">
    
    
</figure>
</p>
<p>All coefficients $U_I$ arise as $2^p$ different versions of this circuit where each rotation gate is replaced either by an identity or by a generator, just as at the figure above. Although these circuits might all look different, in fact there is just a handful of independent ones. This is due to the following commutation rules, which are easy to check:</p>
<p><figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/analytic_vqe/commutation.png" alt="Drawing">
    
    
</figure>
</p>
<p>These commutation rules allow to move <em>all the pauli matrices</em> past CZ gates and to the beginning of the circuit. For example, the circuit $U_{1101}$ from above can be alternatively be rewritten as</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cz</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">global_phase</span><span class="o">=</span><span class="n">pi</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">'mpl'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then, any string of Pauli matrices is equal to $I, X, Z$ or $Y\simeq XZ$ up to a global phase. So in the end, up to phase factors there are only $4^n$ linearly independent matrices $U_I$ where $n$ is the number of qubits. The counting $4^n$ follows because after all the generators have been placed at the beginning of the circuit there can be only 4 different operators at each qubit thread. Note also that $4^n$ is precisely the dimension of the unitary group on $n$ qubits. We thus see that all of $2^p$ matrix coefficients can be divided into $4^n$ distinct classes and within each class $U_I=e^{i\phi}U_{I'}$. This global phase makes no difference for the averages in \eqref{L average} which can therefore be rewritten as</p>
\begin{align*}
\overline{L}=\frac{1}{4^n}\sum_{c} \langle 0|U_c^\dagger H U_c|0\rangle \ ,
\end{align*}<p>where now the sum is over representatives of distinct classes. So the sum is reduced from $2^p$ to $4^n$ terms. OK, so how does the number of parameters and the number of qubits compare? Is this really a reduction?</p>
<p>Yes it is! First, if you want your parametrized quantum circuit to cover any unitary transformation on $n$ qubits you need at least $p=4^n$ parameters, because this is the dimension of the unitary group. So in this case we have and exponential reduction from $2^{4^n}$ to $4^n$. But even if you only put two rotation gates on each qubit you already got yourself $4^n$ parameters. Adding anything beyond that, as you definitely wish to do, makes the reduction from $2^p$ to $4^n$ essential. Note though that it is still exponential in the number of qubits and would be unfeasible to compute exactly for a large system.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Loss-landscape-as-charge-density">
<a class="anchor" href="#Loss-landscape-as-charge-density" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loss landscape as charge density<a class="anchor-link" href="#Loss-landscape-as-charge-density"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>OK, here is a brief justification for why I was interested in the average loss in the first place. Generic hamiltonian-agnostic VQE algorithms have in fact lots of trainability issues. One is the presence of the <a href="https://arxiv.org/abs/1803.11173">barren plateaus</a> in certain regimes, which means that large portions of the parameter space have vanishing gradients and are bad places for optimizer to be in. Another issue is the presence of local minimums which <a href="https://arxiv.org/abs/2205.05786">can be just as bad</a>. So I was wondering if it is possible to somehow use the analytic properties of the VQE loss functions to help mitigate these problems. Here is an idea that probably does not work, but I think still is sort of fun.</p>
<p>Here is an example of a bad loss landscape, sketched in black:
<figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/analytic_vqe/loss.png" alt="Drawing">
    
    
</figure>
</p>
<p>It has many local minimums and flat parts, and only a single narrow global minimum. If we are only allowed to probe this loss landscape one value at a time we will have really hard time reaching the global minimum. However, if we have additional information we might be able to do better.</p>
<p>Let's assume that we know $\Delta^{-1} L(\theta)$ where $\Delta$ is the Laplace operator. <a href="https://en.wikipedia.org/wiki/Poisson%27s_equation">Physics interpretation</a> is the following. If we view the loss landscape as the charge density $\Delta^{-1}L(\theta)$ is the corresponding electric potential, sketched in red. Minimizing the electric potential instead of the charge density might be a much nicer problem because the electric field (the gradient of the potential field) typically stretches far away from localized charges and can attract the probe. Extreme example is the charge density of the point particle, which is impossible to find unless you trip over it. However, if you can probe the electric field of this charge you have an easy way discovering where it comes from. Sounds good, right? Well, not so fast. First, we do not know $\Delta^{-1}L(\theta)$ for a typical VQE loss. Second, my examples were specifically crafted to sell the idea. It is easy to imagine a loss landscape where this does not help.</p>
<p>But we are not boring nitpickers, are we? Of course not, we are imaginative and brave, so we are going to assume even more. Let's pretend that each successive application of $\Delta^{-1}$ makes our loss landscape better, so we are really interested in 
\begin{align*}
\mathcal{L}(\theta)=\Delta^{-\infty} L(\theta) \ .
\end{align*}
Turns out this limiting landscape is very simple and can be found in a similar way to the average considered in the previous section. Indeed, the loss function \eqref{loss exp} can be represented in the following form 
\begin{align*}
L(\theta)=const+A_1\cos(\theta_1)+B_1\sin(\theta_1)+A_2\cos(\theta_2)+B_2\sin(\theta_2)+A_{12}\cos(\theta_1)\cos(\theta_2)+B_{12}\cos(\theta_1)\sin(\theta_2)+\dots
\end{align*}
This is an example with two parameters and several cross-terms are omitted. Here is the key point -- each cross-term gets smaller under application of $\Delta^{-1}$, e.g. $\Delta^{-1} \cos\theta_1=\cos\theta_1$, $\Delta^{-1} \cos\theta_1\cos\theta_2=\frac12 \cos\theta_1\cos\theta_2$ etc. This means, that under the application of $\Delta^{-\infty}$ only the single-variable terms will survive (we ignore the constant term)
\begin{align*}
\mathcal{L}(\theta)=\Delta^{-\infty}L(\theta)=\sum_{i=1}^{p}\left(A_i\cos\theta_i+B_i\sin\theta_i\right)\,\,\substack{p=2\\=}\,\,A_1\cos(\theta_1)+B_1\sin(\theta_1)+A_2\cos(\theta_2)+B_2\sin(\theta_2)
\end{align*}</p>
<p>These terms are easy to compute if we can compute averages. For example, averaging over all $\theta_i$ except theta $\theta_1$ will only leave the monomials with $\theta_1$
\begin{align*}
A_1\cos{\theta_1}+B_1\sin{\theta_1}=\frac{1}{(2\pi)^{p-1}}\int_0^{2\pi} \prod_{i=2}^pd\theta_i\,\, L(\theta) \ .
\end{align*}
How to perform the average on the rhs was shown in the previous section. Since the limiting loss function $\mathcal{L}(\theta)$ is a sum of single-variable terms it is extremely simple to optimize, and the minumimum is unique</p>
\begin{align*}
\theta^* = (\theta_1^*, \theta_2^*,\dots) = \operatorname{argmin}_\theta \mathcal{L}(\theta) \ .
\end{align*}<p>The derivation above also gives a different, less exotic, interpretation of $\theta^*$. Each angle $\theta_i^*$ is the angle that minimizes the average loss function, where average is taken with respect to all other angles. Knowing how to find parameter value that optimizes an average performance does not seem like a completely useless information, does it? Could it help to alleviate the problems with barren plateaus or local minimums? I do not know, but I'm planning on making some numerical experiments along these lines.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Beyond-simple-trigonometry">
<a class="anchor" href="#Beyond-simple-trigonometry" aria-hidden="true"><span class="octicon octicon-link"></span></a>Beyond simple trigonometry<a class="anchor-link" href="#Beyond-simple-trigonometry"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I was really impressed with a recent paper <a href="http://arxiv.org/abs/2205.05786c/">Beyond Barren Plateaus: Quantum Variational Algorithms Are Swamped With Traps</a>. Adopting some techniques from the study of neural networks the authors provide a random matrix theory description of a generic loss landscape for Hamiltonian-agnostic VQE. They show that for underparametrized circuits (when the number of parameters $p$ is smaller than the dimension of the unitary group $4^n$, which is basically the only reasonable setup) the loss landscape is really bad, with exponentially many local minimums being located far away (energy-wise) from the global minimum. They even provide an analytic distribution for the expected number of local minimums, which seems to match my numerical experiments rather well:
<figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/analytic_vqe/theorypractice.png" alt="Drawing">
    
    
</figure>

This is yet another piece of evidence showing that complexity of the classical optimization loop in variational algorithms can not be ignored, as if the problems posed by getting a real quantum device to work were not enough. One possible way to alleviate the issues is to use specifically designed parametrized circuits, which are aware of the symmetries or additional properties of the Hamiltonian. I have a feeling though, that even performance of a generic Hamiltonian-agnostic VQE could be improved by exploiting some structural properties of the loss landscapes. In this blog post to speculated about what could such an approach look like.</p>

</div>
</div>
</div>
</div>

<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script>



<script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       processEscapes: true
     }
   });
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="idnm/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/qml/vqa/vqe/2022/05/17/Some-analytic-facts-about-variational-algorithms.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>My take on various quantum concepts and brief reviews of latest research papers</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
