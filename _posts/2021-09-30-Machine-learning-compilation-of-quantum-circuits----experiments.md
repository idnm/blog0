---
keywords: fastai
description: Flexible and efficient learning with JAX+numpy
title: Machine learning compilation of quantum circuits -- experiments
toc: true 
badges: true
comments: true
categories: [qiskit, JAX, machine learning, compilation]
image: images/upsidedown.jpg
nb_path: _notebooks/2021-09-30-Machine learning compilation of quantum circuits -- experiments.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-09-30-Machine learning compilation of quantum circuits -- experiments.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Introduction">Introduction<a class="anchor-link" href="#Introduction"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">value_and_grad</span><span class="p">,</span> <span class="n">ops</span><span class="p">,</span> <span class="n">jit</span><span class="p">,</span> <span class="n">lax</span><span class="p">,</span> <span class="n">vmap</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">partial</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># !pip install tensornetwork</span>
<span class="c1"># !pip install optax</span>
<span class="c1"># !pip install qiskit</span>
<span class="c1"># !pip install pylatexenc</span>

<span class="kn">import</span> <span class="nn">tensornetwork</span> <span class="k">as</span> <span class="nn">tn</span>
<span class="n">tn</span><span class="o">.</span><span class="n">set_default_backend</span><span class="p">(</span><span class="s1">&#39;jax&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">optax</span>

<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">transpile</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">Operator</span><span class="p">,</span> <span class="n">Statevector</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit</span> <span class="kn">import</span> <span class="n">Parameter</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler.passes.synthesis</span> <span class="kn">import</span> <span class="n">UnitarySynthesis</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">PassManager</span>
<span class="kn">from</span> <span class="nn">qiskit.converters</span> <span class="kn">import</span> <span class="n">circuit_to_gate</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">unitary_group</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>WARNING:absl:No GPU/TPU found, falling back to CPU. (Set TF_CPP_MIN_LOG_LEVEL=0 and rerun for more info.)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Motivation">Motivation<a class="anchor-link" href="#Motivation"> </a></h2><p>Ever since I read the paper by L.Madden and A.Simonetto (<a href="http://arxiv.org/abs/2106.05649">original preprint</a>, <a href="https://idnm.github.io/blog/machine%20learning/compilation/qiskit/paper%20review/2021/07/22/Machine-learning-compilation-of-quantum-circuits.html">my review</a>) I knew I want to do this kind of experiments myself. At first I hoped that there is a well-established framework where I can easily build quantum circuits and then optimize them efficiently. However, <a href="https://quantumcomputing.stackexchange.com/questions/20718/software-tools-to-train-quantum-circuits-with-parameters">I was not able to find a good fit for my problem</a> (I later found <a href="https://quimb.readthedocs.io/en/latest/index.html">quimb</a> which <a href="https://quimb.readthedocs.io/en/latest/examples/ex_tn_train_circuit.html">might do what I want</a>, but in the end I'm glad I worked things out from scratch). In the end I went for <code>numpy</code>+<code>JAX</code> combination which while being quite low-level was not a big problem to get working.</p>
<p>Here I will give a walk thorough this implementation and show experiments with compilation of random unitaries. However, in my opinion truly interesting stuff is concerned with the compilation of special gates, say multi-controlled Toffolis on restricted connectivity. I intend to look at this kind problems in detail in a future blog post, also see <a href="http://arxiv.org/abs/2109.13223">this preprint</a> for advances in that direction.</p>
<blockquote><p><em>NOTE</em>:While I was working on my own experiments another <a href="http://arxiv.org/abs/2109.06770">preprint appeared</a>, by P.Rakyta and Z.Zimbor√°s, which is very similar to the work of M&amp;S in terms of numerical results. Despite the striking similarities these works are independent. As a bonus R&amp;Z also provide a numerical package <a href="https://zenodo.org/record/4508680#.YVw-uYBBxNi">SQUANDER</a> that allows to play with their framework for compilation of unitaries. You might wish to check that out if you are interested in doing some experiments yourself.</p>
</blockquote>
<h2 id="The-problem">The problem<a class="anchor-link" href="#The-problem"> </a></h2><p>OK, so first a brief recap of what is the compilation problem. Given a quantum circuit we need to find an equivalent one, which satisfies certain requirements. A typical restrictions are to use only some specific two-qubits gates and to be compatible with limited connectivity. I gave a more detailed intro <a href="https://idnm.github.io/blog/machine%20learning/compilation/qiskit/paper%20review/2021/07/22/Machine-learning-compilation-of-quantum-circuits.html">here</a>. Here is a nearly-trivial example: a simple $CNOT$ gate</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>can be decomposed in terms of the entangling $CZ$ gate and single-qubit gates $rx, ry, rz$ as follows</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qc_compiled</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">basis_gates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cz&#39;</span><span class="p">,</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="s1">&#39;ry&#39;</span><span class="p">,</span> <span class="s1">&#39;rz&#39;</span><span class="p">],</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc_compiled</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, for generic $n$-qubit unitaries one needs exponentially many entangling gates for the compilation. More precisely, there is a <a href="https://dl.acm.org/doi/10.5555/968879.969163">theoretical lower bound</a> $\#CNOTs\ge \frac14 \left(4^n-3n-1\right)$ on the amount of $CNOT$s required for compilation of any $n-$qubit unitary outside a measure zero set. Crucially, this measure zero set might in fact be of principal interest to quantum computing as it includes many operators featuring in most algorithms (such as multi-controlled gates). In this post I will only adress compilation of random unitaries and discuss compilation of special cases in a future post. For later reference here is the function returning a theoretical lower bound</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">TLB</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="mi">4</span><span class="o">**</span><span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TLB for </span><span class="si">{}</span><span class="s1">-qubit unitary is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">TLB</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>TLB for 1-qubit unitary is 1
TLB for 2-qubit unitary is 3
TLB for 3-qubit unitary is 14
TLB for 4-qubit unitary is 61
TLB for 5-qubit unitary is 253
TLB for 6-qubit unitary is 1020
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, there is an algorithm called <a href="https://arxiv.org/abs/quant-ph/0406176">quantum Shannon decomposition</a> to decompose an arbitary $n$-qubit unitary into a sequence of $CNOT$s and single-qubit rotations which requires roughly twice as many $CNOT$s as the theoretical lower bound implies.</p>
<h2 id="3-qubit-example">3-qubit example<a class="anchor-link" href="#3-qubit-example"> </a></h2><p>As papers <a href="http://arxiv.org/abs/2106.05649">M&amp;S</a> and <a href="http://arxiv.org/abs/2109.06770">R&amp;Z</a> show, one can do better and eliminate the 2x overhead, at least numerically. Namely, it seems that precisely at the theoretical lower bound the exact or nearly-exact compilation is possible. Here is a real-life example. Consider the following 3-qubit circuit with $TLB(3)=14$ $CNOT$ gates</p>
<p>{% include image.html alt="Drawing" style="width: 800px;" file="/blog/images/copied_from_nb/myimages/3qubitsequ.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The claim is that with the appropriate choice of angles in rotation gates it can morhp into <em>any</em> 3-qubit unitary. To find the corresponding angles it is sufficient to run a numerical optimization minimizing the fidelity between this circuit's unitary and the target unitary. This is rather imressive, but calls for many questions. Why choose $CNOT$ gates? Why place them in that exact order? It appears to be an experical fact that precise location of entangling gates as well as their choice ($CNOT$, $CZ$, etc) makes little difference. Moreover, even restricted connectivity does not seem to force an overhead for compilation. I will back up these claims with numerical experiments.</p>
<h2 id="Contents">Contents<a class="anchor-link" href="#Contents"> </a></h2><p>The rest of this post is divided into two parts. In the first I write some <code>numpy</code>/<code>JAX</code>/<code>qiskit</code> code that allows to construct and efficiently optimize circuits of interest. I try to give some explanations of the underlying numerical framework, but please do not mistake me for a real expert on the topic. Still, the resulting performance seems to be good enough to reproduce results of the existing preprints. This part can safely be skipped if you are only interested in the results.</p>
<p>In the second part of the post I will do a number of experiments compiling random unitaries with varying numbers of qubits, different types of entangling gates, restricted connectivity and try to draw some general lessons from them.</p>
<blockquote><p><em>NOTE</em>:This blog post is also a fully-functional jupyter notebook. You can open it in colab or download it and perform more experiments yourself!</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Numerical-framework">Numerical framework<a class="anchor-link" href="#Numerical-framework"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Building-blocks-for-quantum-circuits">Building blocks for quantum circuits<a class="anchor-link" href="#Building-blocks-for-quantum-circuits"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First let us define the basic 1- and 2-qubit gates in matrix form. For now you can safely ignore the use <code>jnp</code> arrays instead of <code>np</code> arrays.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Controlled-NOT (or controlled-X gate)</span>
<span class="n">cx_mat</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

<span class="c1"># Controlled-Z gate</span>
<span class="n">cz_mat</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

<span class="c1"># Pauli matrices</span>
<span class="n">x_mat</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

<span class="n">y_mat</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>

<span class="n">z_mat</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

<span class="c1"># Rotation gates</span>
<span class="k">def</span> <span class="nf">rx_mat</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">jnp</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">x_mat</span><span class="o">*</span><span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ry_mat</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">jnp</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">y_mat</span><span class="o">*</span><span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">rz_mat</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">jnp</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">z_mat</span><span class="o">*</span><span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The circuits that we are going to train will be built out of two types of 2-qubit blocks. Here are the definitions:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">block</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate_name</span><span class="p">,</span> <span class="n">angles</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gate_name</span> <span class="o">=</span> <span class="n">gate_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="n">angles</span>
    
    <span class="c1"># Quantum circuit in `qiskit` corresponding to our block</span>
    <span class="k">def</span> <span class="nf">circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_name</span> <span class="o">==</span> <span class="s1">&#39;cx&#39;</span><span class="p">:</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_name</span> <span class="o">==</span> <span class="s1">&#39;cz&#39;</span><span class="p">:</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">cz</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gate &#39;</span><span class="si">{}</span><span class="s2">&#39; not yet supported&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gate_name</span><span class="p">))</span>
        
        <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span> <span class="c1"># convert from JAX array to numpy array if applicable.</span>
        
        <span class="n">qc</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">qc</span>
    
    <span class="c1"># JAX-compatible unitary corresponding to our block</span>
    <span class="k">def</span> <span class="nf">unitary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_name</span> <span class="o">==</span> <span class="s1">&#39;cx&#39;</span><span class="p">:</span>
            <span class="n">entangling_matrix</span> <span class="o">=</span> <span class="n">cx_mat</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_name</span> <span class="o">==</span> <span class="s1">&#39;cz&#39;</span><span class="p">:</span>
            <span class="n">entangling_matrix</span> <span class="o">=</span> <span class="n">cz_mat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gate &#39;</span><span class="si">{}</span><span class="s2">&#39; not yet supported&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gate_name</span><span class="p">))</span>
        
        <span class="n">x_rotations</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">rx_mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">rx_mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">y_rotations</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">ry_mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">ry_mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        
        <span class="k">return</span> <span class="n">x_rotations</span> <span class="o">@</span> <span class="n">y_rotations</span> <span class="o">@</span> <span class="n">entangling_matrix</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is how they look:
<code>cz</code> block</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span> <span class="o">=</span> <span class="p">[</span><span class="n">Parameter</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;a0&#39;</span><span class="p">,</span> <span class="s1">&#39;a1&#39;</span><span class="p">,</span> <span class="s1">&#39;a2&#39;</span><span class="p">,</span> <span class="s1">&#39;a3&#39;</span><span class="p">]]</span>
<span class="n">block</span><span class="p">(</span><span class="s1">&#39;cz&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">])</span><span class="o">.</span><span class="n">circuit</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and <code>cx</code> block</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">block</span><span class="p">(</span><span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">])</span><span class="o">.</span><span class="n">circuit</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our <code>block</code> class can return a <code>qiskit</code> circuit and the correponding unitary matrix. Of course we could have extracted the unitary from the circuit itself via <code>qiskit</code> API, but this would make the matrix representation incompatible with <code>JAX</code> which will be our workhorse for optimization. So at this point we needed a bit of wheel reivention. Let's check that our implementation is consistent with <code>qiskit</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">key</span><span class="p">,</span> <span class="n">subkey</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> 
<span class="n">angles</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,),</span> <span class="n">minval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">jnp</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="s1">&#39;cz&#39;</span><span class="p">]:</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">block</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">angles</span><span class="p">)</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">circuit</span><span class="p">()</span>
    <span class="n">qs_unitary</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">reverse_bits</span><span class="p">())</span><span class="o">.</span><span class="n">data</span> <span class="c1"># Yes, we need to reverse bits in qiskit to match our conventions.</span>
    <span class="n">our_unitary</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">unitary</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;qiskit unitary is the same as our unitary for block with gate </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">qs_unitary</span><span class="p">,</span> <span class="n">our_unitary</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>qiskit unitary is the same as our unitary for block with gate cx: True
qiskit unitary is the same as our unitary for block with gate cz: True
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To match matrix representations of quantum circuits might be a headache as I discussed in <a href="https://idnm.github.io/blog/qiskit/tensor%20networks/quantum%20concepts/2021/08/18/Matrix-representation-of-quantum-circuits.html">another post</a>, so this was a neseccary check to do.</p>
<p>Our two bulding blocks (<code>cz</code> and <code>cx</code>) only differ by the type of the two-qubit gate. The circuits that we are going to build seem to do equally well for any choice of two-qubit gate. I will mostly use <code>cz</code> gate because it is symmetric under the swap of qubits, but I will also occasinally bring up the <code>cx</code> gate to illustrate that it has the same performance. Angles $a_0$-$a_3$ are going to be optimized.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Optimization-with-JAX">Optimization with <code>JAX</code><a class="anchor-link" href="#Optimization-with-JAX"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What is <code>JAX</code>? Well, it's basically <code>numpy</code> on steroids. You can check out <a href="https://jax.readthedocs.io/en/latest/notebooks/quickstart.html">the official documentation</a> or numerous nice overwievs on the web. For our purposes two key features of <code>JAX</code> are</p>
<ol>
<li>Autograd </li>
<li>JIT or just-in-time compilation</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will use the following measure of discrepance between two unitaries $disc(U, V) = 1-\frac1{N}\operatorname{Tr}\left( U^\dagger V\right)$ where $U,V$ are $N\times N$ matices. It is normalized so that $disc(U,U)=0$. Note that this measure is insensitive to global phases of each matrix as is natural in our context.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">disc</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">U_target</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">U_target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">-</span><span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">U</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="n">U_target</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">/</span><span class="n">n</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is the optimization routine that we are going to use. I will not give much explanations, but illustrate with an example.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">))</span> <span class="c1"># &lt;--- Here is where the magic happens! Remove this line and everything will run 1000 times slower:)</span>
<span class="k">def</span> <span class="nf">unitary_update</span><span class="p">(</span><span class="n">loss_and_grad</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">,</span> <span class="n">angles</span><span class="p">):</span>
    <span class="n">loss</span><span class="p">,</span> <span class="n">grads</span> <span class="o">=</span> <span class="n">loss_and_grad</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
    <span class="n">updates</span><span class="p">,</span> <span class="n">opt_state</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grads</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">)</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">apply_updates</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">updates</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">angles</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">,</span> <span class="n">loss</span>

<span class="k">def</span> <span class="nf">unitary_learn</span><span class="p">(</span><span class="n">U_func</span><span class="p">,</span> <span class="n">U_target</span><span class="p">,</span> <span class="n">n_angles</span><span class="p">,</span> 
                  <span class="n">init_angles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                  <span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">num_iterations</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> 
                  <span class="n">target_disc</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="n">init_angles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_angles</span><span class="p">,),</span> <span class="n">minval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">jnp</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">init_angles</span>
    
    <span class="n">loss_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">angles</span><span class="p">:</span> <span class="n">disc</span><span class="p">(</span><span class="n">U_func</span><span class="p">(</span><span class="n">angles</span><span class="p">),</span> <span class="n">U_target</span><span class="p">)</span>

    <span class="n">loss_and_grad</span> <span class="o">=</span> <span class="n">value_and_grad</span><span class="p">(</span><span class="n">loss_func</span><span class="p">)</span>

    <span class="n">opt</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="p">)</span>
    <span class="n">opt_state</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unitary_update</span><span class="p">(</span><span class="n">loss_and_grad</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">,</span> <span class="n">angles</span><span class="p">)</span>
    
    <span class="n">angles_history</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">loss_history</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">):</span>
        <span class="n">angles</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">)</span>
        <span class="n">angles_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
        <span class="n">loss_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">loss</span> <span class="o">&lt;</span> <span class="n">target_disc</span><span class="p">:</span>
            <span class="k">break</span>
    
    <span class="k">return</span> <span class="n">angles_history</span><span class="p">,</span> <span class="n">loss_history</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>OK, now a very simple example. Say we want to find an $ZXZ$ decomposition of  $Y$-gate. Define:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">zxz_ansatz</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">rz_mat</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">@</span> <span class="n">rx_mat</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">@</span> <span class="n">rz_mat</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Running the learning is now very simple: we give <code>unitary_learn</code> the function that is learning, the target unitary and also explicitly the number of parameters to be trained:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">angles_history</span><span class="p">,</span> <span class="n">loss_history</span> <span class="o">=</span> <span class="n">unitary_learn</span><span class="p">(</span><span class="n">zxz_ansatz</span><span class="p">,</span> <span class="n">y_mat</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can visualize the pcoess of learning as follows:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loss_history</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The learned angles in $ZXZ$ decomposition are</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">angles_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>DeviceArray([6.59216  , 3.1411407, 3.4505684], dtype=float32)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And it is not difficult to check directly that the result is equal to the $Y$ matrix up to a global phase.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Quantum-circuits-with-numpy">Quantum circuits with numpy<a class="anchor-link" href="#Quantum-circuits-with-numpy"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to implement several procedures to construct unitaries of the quantum circuits.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">transposition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">placement</span><span class="p">):</span>
    <span class="n">w</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">placement</span><span class="p">):</span>
        <span class="n">t</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">t</span>

<span class="k">def</span> <span class="nf">apply_gate_to_tensor</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">tensor</span><span class="p">,</span> <span class="n">placement</span><span class="p">):</span>
    <span class="n">gate_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">tensor_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">gate_contraction_axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">gate_width</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">gate_width</span><span class="p">))</span>

    <span class="n">contraction</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">tensor</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">gate_contraction_axes</span><span class="p">,</span> <span class="n">placement</span><span class="p">])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">transposition</span><span class="p">(</span><span class="n">tensor_width</span><span class="p">,</span> <span class="n">placement</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">tensor_width</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">tensor_width</span><span class="p">))</span> <span class="c1"># last indices are intact</span>

    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">contraction</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">split_angles</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">,</span> <span class="n">layer_len</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">free_placements_len</span><span class="p">):</span>
    
    <span class="n">surface_angles</span> <span class="o">=</span> <span class="n">angles</span><span class="p">[:</span><span class="mi">3</span><span class="o">*</span><span class="n">num_qubits</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">block_angles</span> <span class="o">=</span> <span class="n">angles</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">num_qubits</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">layers_angles</span> <span class="o">=</span> <span class="n">block_angles</span><span class="p">[:</span><span class="n">layer_len</span><span class="o">*</span><span class="n">num_layers</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_layers</span><span class="p">,</span> <span class="n">layer_len</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">free_block_angles</span> <span class="o">=</span> <span class="n">block_angles</span><span class="p">[</span><span class="n">layer_len</span><span class="o">*</span><span class="n">num_layers</span><span class="p">:]</span>
    
    <span class="k">return</span> <span class="n">surface_angles</span><span class="p">,</span> <span class="n">block_angles</span><span class="p">,</span> <span class="n">layers_angles</span><span class="p">,</span> <span class="n">free_block_angles</span>

<span class="k">def</span> <span class="nf">build_unitary</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">,</span> <span class="n">block_type</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span> <span class="n">layer_placements</span><span class="o">=</span><span class="p">[[],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">free_placements</span><span class="o">=</span><span class="p">[]):</span>
    
    <span class="n">layer</span><span class="p">,</span> <span class="n">num_layers</span> <span class="o">=</span> <span class="n">layer_placements</span>
    
    <span class="n">layer_depth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>    
    <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span><span class="o">*</span><span class="n">num_layers</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">free_placements</span><span class="p">)</span>
    
    <span class="n">surface_angles</span><span class="p">,</span> <span class="n">_</span> <span class="p">,</span> <span class="n">layers_angles</span><span class="p">,</span> <span class="n">free_block_angles</span> <span class="o">=</span> <span class="n">split_angles</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="p">),</span> <span class="n">num_layers</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">free_placements</span><span class="p">))</span>
    
<span class="c1">#     print(&#39;u angles are {}&#39;.format(angles))</span>
<span class="c1">#     print(&#39;u surface angles are {}&#39;.format(surface_angles))</span>
<span class="c1">#     print(&#39;u layers angles are {}&#39;.format(layers_angles))</span>
<span class="c1">#     print(&#39;u free block angles are {}&#39;.format(free_blocks_angles))</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">num_qubits</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">num_qubits</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Initial round of single-qubit gates</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">surface_angles</span><span class="p">):</span>
        <span class="n">gate</span> <span class="o">=</span> <span class="n">rz_mat</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">@</span> <span class="n">rx_mat</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">@</span> <span class="n">rz_mat</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">apply_gate_to_tensor</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="c1"># Sequence of layers wrapped in fori_loop.</span>
    <span class="n">layers_angles</span> <span class="o">=</span> <span class="n">layers_angles</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_layers</span><span class="p">,</span> <span class="n">layer_depth</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_layer</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">layers_angles</span><span class="p">):</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">layers_angles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">layer</span><span class="p">):</span>
            <span class="n">gate</span> <span class="o">=</span> <span class="n">block</span><span class="p">(</span><span class="n">block_type</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">unitary</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">apply_gate_to_tensor</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">u</span>

    <span class="k">if</span> <span class="n">num_layers</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">apply_layer</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">layers_angles</span><span class="p">),</span> <span class="n">u</span><span class="p">)</span>
    
    <span class="c1"># Add remainder(free) blocks.</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">free_block_angles</span><span class="p">,</span> <span class="n">free_placements</span><span class="p">):</span>
        <span class="n">gate</span> <span class="o">=</span> <span class="n">block</span><span class="p">(</span><span class="n">block_type</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">unitary</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">apply_gate_to_tensor</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">num_qubits</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">num_qubits</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Packing-everything-together:-ansatz-circuits">Packing everything together: ansatz circuits<a class="anchor-link" href="#Packing-everything-together:-ansatz-circuits"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, let us build our ansatz circuits from these blocks.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ansatz</span><span class="p">():</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">,</span> <span class="n">block_type</span><span class="p">,</span> <span class="n">layer_placements</span><span class="o">=</span><span class="p">[[],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">free_placements</span><span class="o">=</span><span class="p">[]):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span> <span class="o">=</span> <span class="n">num_qubits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_type</span> <span class="o">=</span> <span class="n">block_type</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span> <span class="o">=</span> <span class="n">layer_placements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_placements</span> <span class="o">=</span> <span class="n">free_placements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_placements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span><span class="o">+</span><span class="n">free_placements</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">num_angles</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">num_qubits</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_placements</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">unitary</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">angles</span><span class="p">:</span> <span class="n">build_unitary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_type</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span> 
                                                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_placements</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">angles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Parameter</span><span class="p">(</span><span class="s1">&#39;a</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_angles</span><span class="p">)])</span>
            
        <span class="n">surface_angles</span><span class="p">,</span> <span class="n">block_angles</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">split_angles</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">,</span> 
                                                          <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span><span class="p">,</span> 
                                                          <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free_placements</span><span class="p">))</span>        
        
        <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)</span>
        
        <span class="c1"># Initial rounf of single-qubit gates</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">surface_angles</span><span class="p">):</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
        
        <span class="c1"># Entangling gates accoring to placements</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">block_angles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_placements</span><span class="p">):</span>
            <span class="n">qc_block</span> <span class="o">=</span> <span class="n">block</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_type</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">circuit</span><span class="p">()</span> 
            <span class="n">qc</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">qc_block</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">qc</span>
        
    <span class="k">def</span> <span class="nf">learn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u_target</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">u_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitary</span>
        <span class="k">return</span> <span class="n">unitary_learn</span><span class="p">(</span><span class="n">u_func</span><span class="p">,</span> <span class="n">u_target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_angles</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ans</span> <span class="o">=</span> <span class="n">ansatz</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="n">free_placements</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span> <span class="n">layer_placements</span><span class="o">=</span><span class="p">[[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span><span class="mi">3</span><span class="p">])</span>
<span class="n">angles</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">ans</span><span class="o">.</span><span class="n">num_angles</span><span class="p">,),</span> <span class="n">minval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">maxval</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">jnp</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">qs_u</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">ans</span><span class="o">.</span><span class="n">circuit</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span><span class="o">.</span><span class="n">reverse_bits</span><span class="p">())</span><span class="o">.</span><span class="n">data</span>
<span class="n">our_u</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">unitary</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>

<span class="n">ans</span><span class="o">.</span><span class="n">circuit</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">qs_u</span><span class="p">,</span> <span class="n">our_u</span><span class="p">))</span>
<span class="c1"># print(qs_u)</span>
<span class="c1"># print(our_u)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>True
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Layers">Layers<a class="anchor-link" href="#Layers"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">sequ_layer</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">fill_layers</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
    <span class="n">num_complete_layers</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
    <span class="n">complete_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer</span><span class="p">,</span> <span class="n">num_complete_layers</span><span class="p">]</span>
    <span class="n">incomplete_layer</span> <span class="o">=</span> <span class="n">layer</span><span class="p">[:</span><span class="n">depth</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="p">)]</span>
    
    <span class="k">return</span> <span class="n">complete_layers</span><span class="p">,</span> <span class="n">incomplete_layer</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Experiments">Experiments<a class="anchor-link" href="#Experiments"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Learning-2-qubit-random-unitary">Learning 2-qubit random unitary<a class="anchor-link" href="#Learning-2-qubit-random-unitary"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is how we can learn a random two-qubit unitary. The ansatz is circuit is this:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">u_target</span> <span class="o">=</span> <span class="n">unitary_group</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ans</span> <span class="o">=</span> <span class="n">ansatz</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;cz&#39;</span><span class="p">,</span> <span class="n">free_placements</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">ans</span><span class="o">.</span><span class="n">circuit</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Invoking the learning process is easy as pie:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="n">angles_history</span><span class="p">,</span> <span class="n">loss_history</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">u_target</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loss_history</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 2.56 s, sys: 34.1 ms, total: 2.59 s
Wall time: 2.54 s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYUAAAD4CAYAAAAD6PrjAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjQuMiwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy8rg+JYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAosUlEQVR4nO3deXyU5b338c8vGwkBErawJSGBIIIgKJFdxaoVqIh1K6goSsGlaPc++Pj0VI/tsT09x6rVWqgiighVRAuoRevGvgQQ2QRiIJCwhDUsISSQ6/kjQxrDYsxMcs9Mvu/Xa17kvuaee37XGOeXa7mvy5xziIiIAER4HYCIiAQPJQUREamgpCAiIhWUFEREpIKSgoiIVIjyOoDzadGihUtLS/M6DBGRkLJy5cp9zrmWNXltUCeFtLQ0srKyvA5DRCSkmFluTV+r7iMREalQZy0FM4sH/gKUAJ8656bV1XuLiEj1+NVSMLPJZlZgZuuqlA82s01mlm1mE3zFNwEznXNjgRv8eV8REakd/nYfTQEGVy4ws0jgeWAI0BUYaWZdgWRgh++0U36+r4iI1AK/koJzbj5woEpxbyDbOZfjnCsBZgDDgTzKE8N539fMxplZlpll7d2715/wRETkW6qNgeZ2/LtFAOXJoB0wC7jZzF4A5pzrxc65Sc65TOdcZsuWNZpRJSIiNVRnA83OuWPAPdU518yGAcMyMjJqNygREfma2mgp5AMplY6TfWV15l8b9jB1yTaOnThZl28rIhLyaiMprAA6mVm6mcUAI4DZ3+YCzrk5zrlxCQkJNQrgn+t38+t/rKfvkx/xu3c3sONAUY2uIyJS3/g7JXU6sATobGZ5ZjbGOXcSGA/MAzYCbzjn1n/L6w4zs0mFhYU1iuuPt1zMWw/058oLWjJ50Tau/OMn/GjaKjbuOlyj64mI1BcWzDuvZWZmOn+XudhVeJxXl+QydUkuR0+c5LtdW/Hw1Z3o1q5mrRARkWBnZiudc5k1em0wJoVKA81jt2zZEpBrFhaV8vLirUxeuJXDxSe5+sIkfnFdZ7q0aRKQ64uIBIuwSwqnBaKlUNXh4lKmLsll0vwcDheXcvOlyfzs2gtomxgX0PcREfFK2CWF2mgpVFVYVMpfPs3m5cXbMOCeAek8MKgjCXHRtfJ+IiJ1JeySwmm10VKoKv/Qcf73g028vTqfhLhofv7dztzeO5XICKvV9xURqS3+JIV6v3R2u8Q4nrqtJ3MfGkiX1k349TvrGP78QlbmHvQ6NBGROheUScHfKak1cVHbBF4f24fnbr+EfUdKuPmFxfzizTXsPXKizmIQEfFave8+OptjJ07y54+zeWlhDrHRkUwYciEjL0slQl1KIhIC1H0UYPENopgw5EL++ZMr6NY2gUffXsftLy4ld/8xr0MTEalVSgrn0bFlI14f24cnb+rO+vzDXPf0fF5ckMOpsuBtXYmI+CMok4IXYwrniYWRvVP54GdXMKBjC3777kZufmEx2QVHvQ5NRCTgNKbwLTjnmL1mJ4/NXs/x0lP836FdGNW3PWYaaxCR4KExhTpiZgzv2Y55P7mCPunN+Y9/rGf0yysoOFzsdWgiIgGhpFADSU1imXLPZTwx/CKWbd3PdU/P55/rdnsdloiI35QUasjMGNUvjbkPXU5y04bc/9pKfvnmGo5qYx8RCWFBmRSCaaD5m2QkNeKtB/oz/qoM3lqVx5Bn5utuaBEJWUGZFPzdea2uxURF8IvrOvPGff0AuG3iEp79aIumropIyAnKpBCqMtOa8d7DlzPs4jY89eFmRk5aSv6h416HJSJSbUoKAdY4NpqnR1zCn37Qgw27DjP46fnM/WKn12GJiFSLkkIt+f4lybz78EA6tmzE+NdX86uZazimQWgRCXJ1lhTMrIOZvWRmM+vqPb3Wvnk8b97fj/FXZfDmyjyu//NC1uYF/+C5iNRf1UoKZjbZzArMbF2V8sFmtsnMss1swvmu4ZzLcc6N8SfYUBQdWT4IPX1sX4pLT3HTC4uY+NlXlGkQWkSCUHVbClOAwZULzCwSeB4YAnQFRppZVzPrbmZzqzySAhp1COrboTnv//hyrunSiiff/5JRk5exR3dCi0iQqVZScM7NBw5UKe4NZPtaACXADGC4c26tc+76Ko+C6gZkZuPMLMvMsvbu3VvtioSCxIYx/OWOS/n9Td1ZlXuIwU/P58MNe7wOS0Skgj9jCu2AHZWO83xlZ2Vmzc3sr8AlZvbIuc5zzk1yzmU65zJbtmzpR3jBycwY0TuVOQ8NpG1iHGNfzeLX76yjuPSU16GJiNTdQLNzbr9z7n7nXEfn3JPnOzeU7miuqYykRsx6sD9jL09n6tJchv15IRt3HfY6LBGp5/xJCvlASqXjZF+ZVFODqEge/V5Xpo7pzaHjpQx/fhFvr87zOiwRqcf8SQorgE5mlm5mMcAIYHYgggq1ZS78dXmnlvzzx5dzaWoiP/37Gv7rvY1aIkNEPFHdKanTgSVAZzPLM7MxzrmTwHhgHrAReMM5tz4QQdWH7qOqmjdqwNQxfbirX3smzc/h3ikrKDxe6nVYIlLPaOe1IPT6su38xz/Wkdq8Ia/c05uUZg29DklEQkjY7bxWH1sKld3eJ5VpP+zDviMnuPmFxRqAFpE6E5RJob6NKZxNnw7NefP+/kSYcdvEJSzL2e91SCJSDwRlUqjvLYXTOrduzFsP9iepcQNGTV7OZ5vD62Y+EQk+QZkU1FL4t3aJccy8vz8ZLRsx9tUsJQYRqVVBmRTk65rGxzDth32UGESk1gVlUlD30ZmqJobF2fu8DklEwlBQJgV1H53d6cSQ1rwh46auZF2+kqaIBFZQJgU5t6bxMbx6bx8S4qIZ/fJytu075nVIIhJGlBRCUOuEWF4d05syB6MmL6NA+zKISIAEZVLQmMI369iyES+Pvoz9R0v44atZHC/R0tsi4r+gTAoaU6ieHimJPDviEtbmF/LzNz/XFp8i4regTApSfdd0bcWjQ7vw3trdPPXhZq/DEZEQF+V1AOK/MQPT+WrvUZ77JJv0FvHc3CvZ65BEJESppRAGzIz/HN6N/h2bM2HWFyzfWnU7bRGR6gnKpKCB5m8vOjKCF+7oRUrThtw3NYvt+4u8DklEQlBQJgUNNNdMQsNoXhp9GWUO7n1lBYeLtUmPiHw7QZkUpObSW8Tz1zt7sW3fMca/vpqTp8q8DklEQoiSQhjq17E5v72xG/M37+W37270OhwRCSGafRSmRvROJbvgKC8u3ErHpEaM6tve65BEJATUaVIwsxuB7wFNgJeccx/U5fvXN48M7cLWfcd4bPZ60po35PJOLb0OSUSCXLW7j8xsspkVmNm6KuWDzWyTmWWb2YTzXcM5945zbixwP/CDmoUs1RUZYTwz8hI6JTXiwWmryC446nVIIhLkvs2YwhRgcOUCM4sEngeGAF2BkWbW1cy6m9ncKo+kSi/9f77XSS1r1CCKF+/OpEFUBKNfXs4eLZ4nIudR7aTgnJsPVL0rqjeQ7ZzLcc6VADOA4c65tc6566s8CqzcH4D3nXOrAlcNOZ/kpg2ZPPoyDh4r4e7Jyyk8rqmqInJ2/s4+agfsqHSc5ys7l4eAa4BbzOz+s51gZuPMLMvMsvbu1baTgXJxciITR2Xy1d6j/PCVFRSXalVVETlTnU5Jdc4965zr5Zy73zn313OcMwl4HFgVExNTl+GFvYGdWvCnH/QkK/eg7mEQkbPyNynkAymVjpN9ZRKkrr+4LY/fcBH/2riHCbPWarltEfkaf5PCCqCTmaWbWQwwApjtb1Ba5qJ23dUvjR9f3YmZK/P43XsbcU6JQUTKVfs+BTObDgwCWphZHvAb59xLZjYemAdEApOdc+v9DcrMhgHDMjIy/L2UnMNPrulE4fFSXlq4lYS4aB6+upPXIYlIELBg/isxMzPTZWVleR1G2Corc/xy5he8tSqPx4Z1ZfSAdK9DEpEAMLOVzrnMmrw2KJe5UEuhbkREGH+4uTtHikt5bM4GmsRFc9Ol2qBHpD4LygXxNKZQd6IiI3h25CX079icX878gg/W7/Y6JBHxUFAmBW2yU7dioyOZdFcm3dolMH76ahZ/tc/rkETEI0GZFNRSqHuNGkQxZfRlpDVvyNhXsliz45DXIYmIB4IyKYg3msbHMHVMH5o1iuHul5ezZc8Rr0MSkToWlElB3UfeadUkltfG9CE6MoI7X1rGjgPa61mkPgnKpKDuI2+1bx7Pa2P6cLzkFGO017NIvRKUSUG817l1Y164sxc5e4/xkNZJEqk3lBTknAZktOCJG7vx2ea9PDF3g9fhiEgd0M1rcl4je6eSs/cof1uwlQ4tG3F3/zSvQxKRWhSULQWNKQSXCUO6cE2XJB6fs56FW3QPg0g4C8qkIMElMsJ4ZsQlZCQ1Yvz0VZqRJBLGlBSkWuIbRDFpVCZlZY5xU1dyvEQ7t4mEIyUFqba0FvE8M/ISvtx9mP/z1hfah0EkDAVlUtDNa8Hrqs5J/OK7nZm9ZicvLdzqdTgiEmBBmRQ00BzcHhzUkSHdWvNf721kUbYGnkXCSVAmBQluZsb/3NqjfOD5dQ08i4QTJQWpkfgGUUwclcnJMsd9GngWCRtKClJj6S3ieXbkJWzUwLNI2KizpGBmXczsr2Y208weqKv3ldp1Veckfnld+cDzXz/L8TocEfFTtZKCmU02swIzW1elfLCZbTKzbDObcL5rOOc2OufuB24DBtQ8ZAk2D1zZkRt6tOW/533JRxv3eB2OiPihui2FKcDgygVmFgk8DwwBugIjzayrmXU3s7lVHkm+19wAvAu8F7AaiOfMjD/cfDHd2ibw4xmfa3MekRBWraTgnJsPHKhS3BvIds7lOOdKgBnAcOfcWufc9VUeBb7rzHbODQHuCGQlxHtxMZFMuqsXsdGRjH01i0NFJV6HJCI14M+YQjtgR6XjPF/ZWZnZIDN71swmcp6WgpmNM7MsM8vau3evH+FJXWuTEMfEUb3YeaiY8dqDQSQk1dlAs3PuU+fcw865+5xzz5/nvEnA48CqmJiYugpPAqRX+6b89vvdWJi9jyfmbtCMJJEQ489+CvlASqXjZF+Z1HO3ZaawZc8R/rZgK20T47jvyo5ehyQi1eRPS2EF0MnM0s0sBhgBzA5EUFrmIvQ9MqQL11/chiff/5J3VutvBZFQUd0pqdOBJUBnM8szszHOuZPAeGAesBF4wzm3PhBBaUG80BcRYfzvbT3o26EZv5y5RpvziIQIC+Y+38zMTJeVleV1GOKHwuOl/GDiErYfKOKVe3tzWVozr0MSCXtmttI5l1mT1wblMhdqKYSPhLhoXr23N62bxDJ68nKytlWd2SwiwSQok4LGFMJLUpNYpo/rS1KTWEa/vIJV2w96HZKInENQJgW1FMJPqyaxTB/bl+aNYrjrpeUs1j4MIkEpKJOCWgrhqXVCLDPG9aVNQnmLYe4XO70OSUSqCMqkIOGrTUIcb97fjx4pCTw0fTV/m5+jG9xEgkhQJgV1H4W3xIYxTB3Th8EXteZ3723kZ2+sobhUm/SIBIOgTArqPgp/sdGRPH/7pfz82gt4e3U+t/x1Mdv2HfM6LJF6LyiTgtQPERHGQ1d34sW7Mtm+v4ihzy5gxvLt6k4S8ZCSgnjumq6tmPfTK+iZksiEWWu5b+pKCo4Uex2WSL0UlElBYwr1T5uEOF4b04dHh3bh0017ufp/P2Pqkm2cKlOrQaQuaZkLCTpf7T3Kr99Zx+Kv9tMjOYHHh3ejZ0qi12GJhIywW+ZC6reOLRsx7Yd9eGZET/IPFXPj84sY//oqtu8v8jo0kbDnz34KIrXGzBjesx1Xd2nFpM++4m8LtjJv/W5G9U3jgUEdadm4gdchioQldR9JSNhzuJg/fbiZN7J2EB0ZwW2ZKYy7ogMpzRp6HZpI0PGn+ygok4KZDQOGZWRkjN2yZYvX4UgQ2brvGBM/+4q3VuVR5mDYxW14YFAGnVs39jo0kaARdknhNLUU5Fx2Fxbz0sIcpi3bTlHJKa6+MIkHr+pIr/bar0FESUHqrUNFJby6JJeXF23lYFEpvdOa8cBVHRl0QUvMzOvwRDyhpCD1XlHJSf6+Ygd/m5/DzsJiOraMZ3T/NG66NJn4BppPIfWLkoKIT8nJMt5du5Mpi7axJq+Qxg2iuDUzhbv6tSetRbzX4YnUCSUFkbNYvf0gUxZv490vdnHKOa7qnMTd/dO4PKMFERHqWpLwFTJJwczigc+Ax5xzc7/pfCUFCYSCw8VMW7adacu2s+/oCdJbxHNHn1Ru7ZVCQsNor8MTCbhaTwpmNhm4HihwznWrVD4YeAaIBF50zv3+G67zn8BRYIOSgtS1EydP8f7a3UxdmsvK3IPERkdwQ4+23NUvjW7ttEy7hI+6SApXUP5l/urppGBmkcBm4FogD1gBjKQ8QTxZ5RL3Aj2A5kAssE9JQby0fmchry3dzjur8zleeoqeKYmM6tue713chtjoSK/DE/FLnXQfmVkaMLdSUuhHeTfQdb7jRwCcc1UTwunX/w6IB7oCx4HvO+fKznLeOGAcQGpqaq/c3NxvWSWR6jtcXMpbK/OYujSXnL3HaNowmtsyU7ijT3tSm+tuaQlN/iQFf+bqtQN2VDrOA/qc62Tn3KMAZjaa8pbCGQnBd94kM9sFDIuJienlR3wi36hJbDT3DEhndP80lny1n6lLc3lx4VYmLchh0AUtGdWvPVdekESkBqalnqjzCdzOuSnVOGcOMCczM3Ns7UckUr4AX/+MFvTPaMHuwmJeX76d6cu3c++ULJKbxnFHn/bclplM80ZaiE/Cmz9LZ+cDKZWOk31lftMmO+Kl1gmx/OzaC1g84Ts8f/ulJDeN4w///JJ+T37Mz/7+Oau2H9SWoRK2/GkprAA6mVk65clgBHB7QKISCQLRkRF87+I2fO/iNmzZc4TXluby1qp8Zq3O56K2TRjVtz039GxLwxjdMS3ho7qzj6YDg4AWwB7gN865l8xsKPA05TOOJjvnfhfI4DT7SILN0RMneWd1Pq8tzeXL3UdoHBvFrb1SuLNvKh1aNvI6PBEghG5eqy4tnS3BzjlHVu5Bpi7J5f11uyg95RiY0YI7+7bnmi5JREVqU0PxTtglhdPUUpBQUHCkmDdW7OD1ZdvZWVhMm4RY7uzbnpG9U2kWH+N1eFIPKSmIBIGTp8r4+MsCXlmyjUXZ+2kQFcGNPdsxekAaXdo08To8qUfCLimo+0hC3eY9R5iyeBuzVuVRXFpGn/RmjO6fxrVdW6lrSWpd2CWF09RSkFB3qKiEv6/YwdSlueQdPE7bhFjuUNeS1LKwSwpqKUi4OVXm+GjjnoqupZioCG7s2Za7+6dxUVstxieBFXZJ4TS1FCQcbd5zhFcWb2PWqvLF+HqnN+MedS1JACkpiISgwqJS3sjawStLtlV0LY3ql8btvVO1z4P4RUlBJISdKnP8a+MepizaxpKc/cTHRDKydyr3DkynbWKc1+FJCAq7pKAxBamvNuw8zKT5XzHni10YMKR7G+7sk0rv9GaYaaVWqZ6wSwqnqaUg9VXewSImL9zGmyt3cKT4JB1bxjOydyoje6cS30BrLcn5KSmIhKnjJaeY88VOXl+2nc93HCKpcQPuu7IjN13Sjqaa0irnoKQgUg+szD3Ak+99SVbuQeJjIrm7fxq390klual2iJOvU1IQqUc27DzMsx9t4YMNu3HAgI4tuDUzme91b6MprQKEYVLQQLPIN8s7WMTMlXnMXJlH3sHj9EhO4O7+aQzr0ZZoJYd6LeySwmlqKYh8s7Iyx8xVefz54y3sOHCc5KZx3HdlR27tlUxsdKTX4YkHlBREhLIyx8dfFvDcJ9l8vuMQURHGPQPSuGeA7neob5QURKSCc46lOQd4aWEO/9pYQExUBAM6NuehqztxaWpTr8OTOqCkICJncM6xfudhpi3L5cMNe9h3tISh3Vvzi+92Jr1FvG6GC2NKCiJyXsdOnORvC3KYND+HopJTXNi6Mfdf2ZHrL9aMpXAUEknBzAYBTwDrgRnOuU+/6TVKCiKBVXC4mJmr8nh92XbyDh6nWXwMP7oqg1szk2kSq0X4woU/SaFafyKY2WQzKzCzdVXKB5vZJjPLNrMJ33AZBxwFYoG8mgQrIv5JahLLg4MyWPCrq5g0qhcdW8bzxNwNDPrjp0xblsuJk6e8DlE8Vq2WgpldQfkX+qvOuW6+skhgM3At5V/yK4CRQCTwZJVL3Avsc86VmVkr4Cnn3B3f9L5qKYjUrrIyx4ptB/jjvE1k5R6kZeMGjO6fxp192mv57hBWJ91HZpYGzK2UFPoBjznnrvMdPwLgnKuaEKpeJwZ43Tl3yzmeHweMA0hNTe2Vm5tbvZqISI0551iUvZ+J879iwZZ9NG4Qxe19U7l3QDqtmsR6HZ58S/4kBX+WW2wH7Kh0nAf0OdfJZnYTcB2QCDx3rvOcc5PMbBcwLCYmppcf8YlINZkZAzu1YGCnFmzYeZjHZq9n4mc5vLYkl+9e1JpfDe5MmwTd61Af1NkavM65WcCsap47B5iTmZk5tnajEpGqurZtwhv392NdfiGTF23l/bW7+XDDHr5zYRLXdm3F1V2SaBij5bvDlT9z0fKBlErHyb4yv5nZMDObVFhYGIjLiUgNdGuXwFO39eTdhwfSIyWB2Wt28tD01Qx9ZgHvr91FWVnwTmeXmvMnKawAOplZum+cYAQwOzBhiUiw6NCyEdN+2Je5Dw2kT3oztu0v4oFpqxj7ahaffFlAcalmLIWT6s4+mg4MAloAe4DfOOdeMrOhwNOUzzia7Jz7XSCD0+wjkeBzuLiUGcu38/S/tlBUcoq2CbE89YOe9GrfVKuzBomQuHnt29DS2SLBr7j0FAu37GPCrLXsO3qCtgmx/PctPbigdSOSGmvGkpfCLimcppaCSPA7euIkH23cw1MfbiZ3fxEAo/q257EbLiIyQusrecGrKakiIjRqEMXwnu3o26E5c7/YxZe7DjN1aS6Lsvdx78B0bstMISZK3UqhIihbCuo+EgltM1fmMXVpLmt2HKJdYhz/dVN3+nVoruRQR9R9JCJBxznH/C37+OWbayg4coKEuGiGdm/NiMtSiY2O5IJWjbR8dy0Ju6SgloJI+NhzuJiFW/bx0sKtbNh1uKL80aFdGNWvvbYMrQVhlxROU0tBJLzsPHSc99ft5om5GwBo3SSWh67OYFiPtlq6O4BqfelsEZFAaJsYx5iB6TwzoicAuw8X8+jb6/jZ3z9nxvLtHDhW4m2AopaCiHijrMyxesdB5q3fw6T5OQBc3qkFr97bW2MNfgq7KamVxhS8DkVEaklEhNGrfTN6pjQlsWE0ry/bzoIt+3h4xufc1a89l6QkaqtQD6ilICJBobj0FAP/8An7jp4A4MoLWvKTazrxwYY9PDioI4015lBtYddSEJH6JzY6kn+MH8DBYyXMWpXP5EVb+WzzXgA27jrMA1d2pG1iHCnNGnocaXhTUhCRoNEuMY52iXF0a5fANV2SWL/zMPmHjjNl8TY+3VSeIO67sgOPDOnicaThS0lBRIJS/4wW9M9oQVHJSQ4VleCAf3y+k4mf5XDfFR3J2naACbPW8t7Dl9M6QQvwBUpQJgUNNIvIaQ1jonh6xCWcKnM0i4/h5UXbGPPKCjbuOkxxaRnTluXy8+929jrMsBGUQ/vOuTnOuXEJCQlehyIiQSIywpgw5EIAVm8/xImTZQA890k2/zlnA8E8aSaUBGVLQUTkbBpERfL2g/1p2jCG9s0bsvfoCX4wcSmTF22lbWIsnVs3pmdKomYq+UFTUkUkpJWeKmPQHz8l/9BxAL5zYRK/vbEbbRPj2LbvGKnNGhJRz/Z10NpHIlKvFRwpZseBIqYt286sVflERhg39GjL26vzaZMQy6+v78rQ7m28DrPO6D4FEanXkhrHktQ4ltYJcew9coI1Ow7x9up8AHYVFvPgtFX88rrOOOdoEhfNoAuSSG2u+x3Ops5aCmYWATwBNAGynHOvfNNr1FIQkZo4XnKKtfmFHDh2gvtfW3XG87f0SuZ/bu3hQWR1o9ZXSTWzyWZWYGbrqpQPNrNNZpZtZhO+4TLDgWSgFMirSbAiItURFxNJ7/RmDO7Whv++5eIznv/kywLKyoK369xL1e0+mgI8B7x6usDMIoHngWsp/5JfYWazgUjgySqvvxfoDCx2zk00s5nAR/6FLiLyza7p0orM9k35/c3dueap+QDsP1bCHz/YxDur82kQFUGnVo2ZNKqXVmelmknBOTffzNKqFPcGsp1zOQBmNgMY7px7Eri+6jXMLA84vVj6qXO9l5mNA8YBpKamVic8EZFzahYfw8wH+n+tLDLCeOHTryqOt+0vInd/EWkt4us6vKDjz81r7YAdlY7zfGXnMgu4zsz+DMw/10nOuUnA48CqmJgYP8ITEfm6HimJAPTr0ByAG3u2rXju8Tnrmbd+Ny8uyOHFBTm8v3aXFyF6rtoDzb6WwlznXDff8S3AYOfcD33Ho4A+zrnxgQpOA80iEkjFpac4WeYwIP/QcTJaNmL/sRJGTFrCV3uPnXH+ql9fS7P40Pvj1KvtOPOBlErHyb4yv5nZMDObVFhYGIjLiYgA5ctzN2oQRXyDKC5o1ZiICKNl4wbM+8kV3Nk3lb4dmvH5f1zLX+64FICt+85MFOHOn6SwAuhkZulmFgOMAGYHIiitfSQidSkqMoLf3tidGeP6kdgwhgtbNwZgm5LC2ZnZdGAJ0NnM8sxsjHPuJDAemAdsBN5wzq0PRFBqKYiIl1KaNSQywthccIRDRSVkFxzlwLHyeTL7jp7gSHEpxaXnnC8DwJHiUkp8i/aFkurOPhp5jvL3gPcCGpGIiMeiIyNIbhrHxM9ymPhZDgBtE2J5Z/wAev+ufDb95Z1aMHVMn3Neo/tjH9CvQ3Omj+tbJzEHipbOFhE5i7TmX5+eurOwmGf+taXieMGWfQA45/jRtFV8uqmg4rnTE3iW5Oyvg0gDKyiTgoiI19Ir3bMwY1xfMpIaMW3Z9oqyBlERlJU5th8o4t21uxj98oqK546VnL9rKZgFZVLQmIKIeK29b8G871/Sjr4dmjNmYHrFc78Z1pUTJ8soOHKCtflnfk8dKio5oyxUBOUqqc65OcCczMzMsV7HIiL1U3xM+dfj6YUvbujRlkdmrQUgI6kRAD/9++fsP3ai4jW/fmcdTeNjiIkM3eUygjIpiIh4bXD31sxbv5ufXnsBAPENonh0aBdOljkuTk7ksrSmHDhWgmF0btWYTXuOMHVprsdR+y8oN9kxs2HAsIyMjLFbtmz5xvNFRLx08lQZGY++f9bnHhlyIfdd2REov6P68TkbuHdAGn9bkMOjQ7uS0DDwW4d6dUdzrdHsIxEJJeU3v3U763NPvv8lR4pLAfjnut1MX76da/80nzey8vjzx8H3R29QJgURkVBzZ9/2ND3HX/1Lcw4AcLzKDW9f7j4CwPzNeykqOVm7AVZTUCYFzT4SkVA0/judzlq+KLv8noaqdzjn7D3KvqMnuGvy8rPuEOeFoEwK6j4SkVA0ZmA6P7nmzMSwevtB4MykcKT4JIePl3ctzd+8t/YDrIagTAoiIqGqceyZXUhr8gqZvWYnR058vYvoaMlJDhf/u+z5T7Ip9CUJrygpiIgEUOPY8pn+LRrF0L55Q17wLcM98bOvKKxyU5tzUHC4uOL4j/M28ZzHg8+6T0FEJICa+JJCp6TGFYvh3XRpO5blHOBg0b9bAS0bN2DvkRPsrpQUACIivL3xLShbChpoFpFQFWHlX+oNYyIrypo2jOFQUQmHKnUNpTSNA2BX4deTQoNIb7+WgzIpaKBZREJVtO9LPdn3pQ/QtGE0x0pOfa2rKLlp+dpKu6skhWc/zubZj7zrQgrKpCAiEqquvKAlT9zYjQlDulSUJTQs3+f59H0JACnNTrcUjgPw8j2XVTz31Ieb6yLUs1JSEBEJoIgIY1Tf9sR9rfvozBlJKZVaCjGREVzVOYmkxg3qLM5zUVIQEalliXExZ5Sd7j7aVVhMI9/g9FHflNV2iXFnnF9XlBRERGpZ4tlaCr7uoxMny2jUoDwpFPk25/EyKdTZlFQzuxy4w/eeXZ1z/evqvUVEvHS2pNAm4d9f/PG+pBAbHUFxaRltE2PrLLaqqpUUzGwycD1Q4JzrVql8MPAMEAm86Jz7/bmu4ZxbACwwsxuBFec6T0Qk3LRNiOOeAWlERRjDe7Zj+dYDxERF8OOrO7Gl4AjXdGkFwMz7+3P9nxcSGx35DVesPdVtKUwBngNePV1gZpHA88C1QB6wwsxmU54gnqzy+nudc6d3tb4dGONHzCIiISUiwvjNsIsqjru1K59uf3oDn8rlrZp4O9hcraTgnJtvZmlVinsD2c65HAAzmwEMd849SXmr4gxmlgoUOueOnO153znjgHEAqamp1QlPREQCxJ+B5nbAjkrHeb6y8xkDvHy+E5xzk4DHgVUxMWeO2IuISO2p09lHzrnfOOcWV+M83dEsIuIBf5JCPpBS6TjZV+Y3rX0kIuINf5LCCqCTmaWbWQwwApgdiKDUUhAR8Ua1koKZTQeWAJ3NLM/MxjjnTgLjgXnARuAN59z6QASlloKIiDeqO/to5DnK3wPeC2hE5dedA8zJzMwcG+hri4jIuQXlMhdqKYiIeMOcc17HcE5mthfIreHLWwD7AhhOqKnP9a/PdQfVX/WHeOdcy5q8OKiTgj/MLMs5l+l1HF6pz/Wvz3UH1V/196/+Qdl9JCIi3lBSEBGRCuGcFCZ5HYDH6nP963PdQfVX/f0QtmMKIiLy7YVzS0FERL4lJQUREakQlknBzAab2SYzyzazCV7HE2hmNtnMCsxsXaWyZmb2oZlt8f3b1FduZvas77P4wswu9S7ywDCzFDP7xMw2mNl6M/uxr7xefAZmFmtmy81sja/+j/vK081sma+ef/etSYaZNfAdZ/ueT/O0AgFgZpFmttrM5vqO61Pdt5nZWjP73MyyfGUB+90Pu6RQaUe4IUBXYKSZdfU2qoCbAgyuUjYB+Mg51wn4yHcM5Z9DJ99jHPBCHcVYm04CP3fOdQX6Aj/y/TeuL5/BCeA7zrkeQE9gsJn1Bf4A/Mk5lwEc5N87HI4BDvrK/+Q7L9T9mPI1106rT3UHuMo517PS/QiB+913zoXVA+gHzKt0/AjwiNdx1UI904B1lY43AW18P7cBNvl+ngiMPNt54fIA/kH5trD17jMAGgKrgD6U38Ub5Suv+P+A8kUr+/l+jvKdZ17H7kedk31ffN8B5gJWX+ruq8c2oEWVsoD97oddS4Ga7QgXDlo553b5ft4NtPL9HNafh6874BJgGfXoM/B1n3wOFAAfAl8Bh1z56sXw9TpW1N/3fCHQvE4DDqyngV8BZb7j5tSfugM44AMzW+nbvhgC+LtfrVVSJbQ455yZhf1cYzNrBLwF/MQ5d9jMKp4L98/AOXcK6GlmicDbwIXeRlQ3zOx6oMA5t9LMBnkcjlcGOufyzSwJ+NDMvqz8pL+/++HYUqi1HeGC3B4zawPg+7fAVx6Wn4eZRVOeEKY552b5iuvVZwDgnDsEfEJ5l0mimZ3+Q69yHSvq73s+Adhft5EGzADgBjPbBsygvAvpGepH3QFwzuX7/i2g/A+C3gTwdz8ck0Kt7QgX5GYDd/t+vpvyfvbT5Xf5ZiH0BQorNTNDkpU3CV4CNjrnnqr0VL34DMyspa+FgJnFUT6espHy5HCL77Sq9T/9udwCfOx8Hcyhxjn3iHMu2TmXRvn/2x875+6gHtQdwMzizazx6Z+B7wLrCOTvvteDJrU0EDMU2Ex5P+ujXsdTC/WbDuwCSinvIxxDeT/pR8AW4F9AM9+5RvlsrK+AtUCm1/EHoP4DKe9X/QL43PcYWl8+A+BiYLWv/uuA//CVdwCWA9nAm0ADX3ms7zjb93wHr+sQoM9hEDC3PtXdV881vsf6099vgfzd1zIXIiJSIRy7j0REpIaUFEREpIKSgoiIVFBSEBGRCkoKIiJSQUlBREQqKCmIiEiF/w9DvPJweSl9nQAAAABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The graph shows that we achive great fidelity in under 500 iterations. Just be be absolutely sure let us double-check using <code>qiskit</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">angles</span> <span class="o">=</span> <span class="n">angles_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">circuit</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
<span class="n">u_qs</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">reverse_bits</span><span class="p">())</span><span class="o">.</span><span class="n">data</span>
<span class="n">disc</span><span class="p">(</span><span class="n">u_qs</span><span class="p">,</span> <span class="n">u_target</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>DeviceArray(2.3841858e-07, dtype=float32)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can try various experiments here: changing gate type from <code>cz</code> to <code>cx</code> (shoud not affect the result), decreasing the number of layers (fidelity won't be nearly as good) etc.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Learning-3-qubit-random-unitary">Learning 3-qubit random unitary<a class="anchor-link" href="#Learning-3-qubit-random-unitary"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>OK, here instead of working at the theoretical lower bound let us make a sweep to see how fidelity increases (error drops) with the number of layers.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="n">n_q</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">u_target</span> <span class="o">=</span> <span class="n">unitary_group</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">n_q</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">best_loss</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[]]</span>
<span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span> <span class="c1"># TLB(3)=14</span>
    <span class="n">layer_placemets</span><span class="p">,</span> <span class="n">free_placements</span> <span class="o">=</span> <span class="n">fill_layers</span><span class="p">(</span><span class="n">sequ_layer</span><span class="p">(</span><span class="n">n_q</span><span class="p">),</span> <span class="n">depth</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="s1">&#39;cz&#39;</span><span class="p">]):</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">ansatz</span><span class="p">(</span><span class="n">n_q</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">layer_placements</span><span class="o">=</span><span class="n">layer_placemets</span><span class="p">,</span> <span class="n">free_placements</span><span class="o">=</span><span class="n">free_placements</span><span class="p">)</span>
        <span class="n">angles</span><span class="p">,</span> <span class="n">loss_history</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">u_target</span><span class="p">,</span> <span class="n">target_disc</span><span class="o">=</span><span class="mf">10e-4</span><span class="p">)</span>
        <span class="n">best_loss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">loss_history</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">best_loss</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;cx loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">best_loss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;cz loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 43.5 s, sys: 1.75 s, total: 45.3 s
Wall time: 40.1 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The lesson here is that both types of two-qubits gate perform similarly well at all depths. I have not done experimenting with other gates, but I expect that this is very generic, i.e. it does not really matter what kind of gate to use at least as far as random unitaries are concerned.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Learning-6-qubit-random-unitary">Learning 6-qubit random unitary<a class="anchor-link" href="#Learning-6-qubit-random-unitary"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I do know that 3 is followed by 4, but shall we perhaps get more ambitious? Let's try to compile a 6-qubit random unitary (you can change $n_q=6$ to whatever you like):</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="n">n_q</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">depth</span> <span class="o">=</span> <span class="n">TLB</span><span class="p">(</span><span class="n">n_q</span><span class="p">)</span>
<span class="n">layer_placements</span><span class="p">,</span> <span class="n">free_placements</span> <span class="o">=</span> <span class="n">fill_layers</span><span class="p">(</span><span class="n">sequ_layer</span><span class="p">(</span><span class="n">n_q</span><span class="p">),</span> <span class="n">depth</span><span class="p">)</span>

<span class="n">u_target</span> <span class="o">=</span> <span class="n">unitary_group</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">n_q</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ans</span> <span class="o">=</span> <span class="n">ansatz</span><span class="p">(</span><span class="n">n_q</span><span class="p">,</span> <span class="s1">&#39;cz&#39;</span><span class="p">,</span> <span class="n">layer_placements</span><span class="o">=</span><span class="n">layer_placements</span><span class="p">,</span> <span class="n">free_placements</span><span class="o">=</span><span class="n">free_placements</span><span class="p">)</span>

<span class="n">angles_history</span><span class="p">,</span> <span class="n">loss_history</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">u_target</span><span class="p">,</span> <span class="n">num_iterations</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loss_history</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 10min 39s, sys: 1min 24s, total: 12min 4s
Wall time: 11min 54s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that depth of the theoretical lower bound for 6 qubits is $TLB(6)=1020$ which implies that there are $\approx 4000$ parameters in our ansatz. On my modest laptop the training completes in under 3 minutes. I would not claim this to be the cutting edge, but our <code>JAX</code> setup seems to be no worse than results from the published papers.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">ccx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">u_toff3</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">reverse_bits</span><span class="p">())</span><span class="o">.</span><span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="n">layer_placements</span><span class="p">,</span> <span class="n">free_placements</span> <span class="o">=</span> <span class="n">fill_layers</span><span class="p">(</span><span class="n">sequ_layer</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">ans</span> <span class="o">=</span> <span class="n">ansatz</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="n">layer_placements</span><span class="o">=</span><span class="n">layer_placements</span><span class="p">,</span> <span class="n">free_placements</span><span class="o">=</span><span class="n">free_placements</span><span class="p">)</span>
<span class="n">ans</span><span class="o">.</span><span class="n">circuit</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">unitary</span>



<span class="n">angles_history</span><span class="p">,</span> <span class="n">loss_history</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">u_toff3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loss_history</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 9.12 s, sys: 234 ms, total: 9.35 s
Wall time: 8.58 s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Restricted-topology">Restricted topology<a class="anchor-link" href="#Restricted-topology"> </a></h2>
</div>
</div>
</div>
</div>
 

<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script>

