<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Classiq coding competition – Toffoli gate decomposition | Notes on &lt; Quantum Computing &gt;</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Classiq coding competition – Toffoli gate decomposition" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Based on the relative phase Toffoli gates" />
<meta property="og:description" content="Based on the relative phase Toffoli gates" />
<link rel="canonical" href="https://idnm.github.io/blog/blog/compilation/paper%20review/2022/06/21/Classiq-Toffoli.html" />
<meta property="og:url" content="https://idnm.github.io/blog/blog/compilation/paper%20review/2022/06/21/Classiq-Toffoli.html" />
<meta property="og:site_name" content="Notes on &lt; Quantum Computing &gt;" />
<meta property="og:image" content="https://idnm.github.io/blog/blog/images/relative_toffoli.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-06-21T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://idnm.github.io/blog/blog/compilation/paper%20review/2022/06/21/Classiq-Toffoli.html","@type":"BlogPosting","headline":"Classiq coding competition – Toffoli gate decomposition","dateModified":"2022-06-21T00:00:00-05:00","datePublished":"2022-06-21T00:00:00-05:00","image":"https://idnm.github.io/blog/blog/images/relative_toffoli.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://idnm.github.io/blog/blog/compilation/paper%20review/2022/06/21/Classiq-Toffoli.html"},"description":"Based on the relative phase Toffoli gates","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://idnm.github.io/blog/blog/feed.xml" title="Notes on &lt; Quantum | Computing &gt;" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1154MLY31V"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1154MLY31V');
</script>


<link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
<meta name="google-site-verification" content="PavVqGD_DmVWpwhYbxaxic6hZ-SgRkZIu6MKjzrGJC8" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Notes on &lt; Quantum | Computing &gt;</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Classiq coding competition -- Toffoli gate decomposition</h1><p class="page-description">Based on the relative phase Toffoli gates</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-06-21T00:00:00-05:00" itemprop="datePublished">
        Jun 21, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      17 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#compilation">compilation</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#paper review">paper review</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/idnm/blog/tree/master/_notebooks/2022-06-21-Classiq Toffoli.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          <div class="px-2">
    <a href="https://colab.research.google.com/github/idnm/blog/blob/master/_notebooks/2022-06-21-Classiq Toffoli.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#What's-in-here?">What&#39;s in here? </a></li>
<li class="toc-entry toc-h1"><a href="#Toffoli-gates">Toffoli gates </a>
<ul>
<li class="toc-entry toc-h2"><a href="#CNOT">CNOT </a></li>
<li class="toc-entry toc-h2"><a href="#3q-Toffoli">3q Toffoli </a></li>
<li class="toc-entry toc-h2"><a href="#n-qubit-Toffoli">n-qubit Toffoli </a></li>
<li class="toc-entry toc-h2"><a href="#Decompositions">Decompositions </a></li>
<li class="toc-entry toc-h2"><a href="#Ancilla-qubits">Ancilla qubits </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Relative-phase-Toffoli-gates">Relative phase Toffoli gates </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Definition">Definition </a></li>
<li class="toc-entry toc-h2"><a href="#Diagonal-gates">Diagonal gates </a></li>
<li class="toc-entry toc-h2"><a href="#Relative-gates-are-shorter">Relative gates are shorter </a></li>
<li class="toc-entry toc-h2"><a href="#Diagonal-gates-commute-with-controls">Diagonal gates commute with controls </a></li>
<li class="toc-entry toc-h2"><a href="#Special-relative-phase-gates">Special relative phase gates </a></li>
<li class="toc-entry toc-h2"><a href="#$RT^4$">$RT^4$ </a></li>
<li class="toc-entry toc-h2"><a href="#$RT^5$">$RT^5$ </a></li>
<li class="toc-entry toc-h2"><a href="#Generalization-of-relative-phase-gates">Generalization of relative phase gates </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Solution-to-the-Classiq-problem">Solution to the Classiq problem </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-06-21-Classiq Toffoli.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">qiskit</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
  <span class="o">!</span>pip install qiskit
<span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">pylatexenc</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
  <span class="o">!</span>pip install pylatexenc
  
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">transpile</span><span class="p">,</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">QuantumRegister</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">OneQubitEulerDecomposer</span><span class="p">,</span> <span class="n">random_clifford</span><span class="p">,</span> <span class="n">Operator</span><span class="p">,</span> <span class="n">Statevector</span>
<span class="kn">from</span> <span class="nn">qiskit.extensions</span> <span class="kn">import</span> <span class="n">UnitaryGate</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit</span> <span class="kn">import</span> <span class="n">Instruction</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="What's-in-here?">
<a class="anchor" href="#What's-in-here?" aria-hidden="true"><span class="octicon octicon-link"></span></a>What's in here?<a class="anchor-link" href="#What's-in-here?"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I participated in <a href="https://www.classiq.io/competition">Classiq coding competition</a> and submitted the second best solution to the <a href="https://www.classiq.io/competition/toffoli">Toffoli</a> decomposition problem. The core technical trick to compress the resulting circuit was the use of the relative phase Toffoli gates, popularized by Dmitri Maslov in <a href="https://arxiv.org/abs/1508.03273">this paper</a>.</p>
<p>In this post I will</p>
<ul>
<li>briefly recap what are the Toffoli gates </li>
<li>introduce relative phase Toffoli gates </li>
<li>explain why are they useful</li>
<li>illustrate by solving the Classiq problem</li>
</ul>
<p>Amusingly, optimizing quantum circuits using an analog device (human brain) was exactly the kind of thing I wanted to avoid when I worked on the automatic compiler <a href="https://arxiv.org/abs/2205.01121">CPFlow</a>. However, our compiler works well only with small circuits, to solve a larger problem one needs to decompose it into digestible pieces. In the end, I found no efficient way to use the computer search in the original problem, but came up with paper-and-pencil solution. The usefulness of the relative phase Toffoli gates, which I will cover in some depth here, of course extends far beyond.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Toffoli-gates">
<a class="anchor" href="#Toffoli-gates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Toffoli gates<a class="anchor-link" href="#Toffoli-gates"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="CNOT">
<a class="anchor" href="#CNOT" aria-hidden="true"><span class="octicon octicon-link"></span></a>CNOT<a class="anchor-link" href="#CNOT"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The simplest "Toffoli" gate is CNOT gate, also known as controlled NOT or controlled X (CX).</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Note, if you draw this interactively and have an error here (happens in Colab), redefine the global variable below.</span>
<span class="c1"># output = 'mpl'</span>

<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It flips the value (applies X gate) of the second qubit if the first qubit is in state $|1\rangle$ and does nothing if the first qubit is in state $|0\rangle$. The first qubit is called the <em>control</em> qubit, the last is called the <em>target</em>. If the target qubit starts in state $|0\rangle$, than CNOT effectively copies that value of the control qubit to the target.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="3q-Toffoli">
<a class="anchor" href="#3q-Toffoli" aria-hidden="true"><span class="octicon octicon-link"></span></a>3q Toffoli<a class="anchor-link" href="#3q-Toffoli"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The regular Toffoli gates is defined on three qubits.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">ccx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It has two controls and one target. This gate flips the value of the target qubit if and only if both of the control qubits are in state $|1\rangle$, and does nothing otherwise. If the target qubit starts in state $|0\rangle$ the Toffoli gate effectively stores the logical AND of the control qubits $q_0 \land q_1$ in the target register.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="n-qubit-Toffoli">
<a class="anchor" href="#n-qubit-Toffoli" aria-hidden="true"><span class="octicon octicon-link"></span></a>n-qubit Toffoli<a class="anchor-link" href="#n-qubit-Toffoli"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This construction has a plain generalization to multiple control qubits, e.g. here is the the Toffoli gate on 5 qubits (with 4 control qubits)</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">mct</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHcAAABrCAIAAADCT4o9AAAKn0lEQVR4nO2da0zT3h/Gz+YAGRMTZmZERS6CM3IzCirI0MhNJWhEMXgHvBJIvCUaSeAFATUGjUFJxMQLRgUBNRpZUJgXGCpIwBgGIjoQZaBjE6+bsJ7fi/Kvc7ALY5x2/vt5tZ5t3dOn7ena8/RbBoQQACAWi48dOxYbG9ve3i4QCEpKSmJjY5ctWwZGglqtDg8P9/Pzy83NHdEX/30ghKWlpZ6enj09PRBCCGFcXJyNjc2PHz/gCOnp6bG1tfX29h7pF/95WN3d3QkJCWfPnuXxeLjvbDY7MDCQzWaPdIXxeDypVDphwgRLbwmm0tvbq1AoZs6cyWAwyNIwPNu3b+dwOCqVijDew8PjyJEj+Ou6urrMzMyTJ0+Wl5eTtB2YRFNT08KFC/El4nK5Fy9eJFvRXwBnZ+eVK1cS052dnQCA+/fvQwjr6+vXrl3b398PIUxPT8/OziZNpkFkMpmTk5PO1kMpowEAQNu+y5cvs1is79+/QwgDAgIqKirwdpVKNXHixL6+PnJkGiQlJWXoPsrlcjEMI1vaIAAAUFxcTExv3rx50aJFEEKlUslgMKRSKfGWi4uL9ieHRaFQaHc++nB1dR3DTnAMYLFYZn/X1dWV6e3t/eXLF3z64cOHhYWFoaGhAIDW1lYIofYxkM1md3d3G5hdb2/v9OnTFy9ebPSHtVfe6ImMjBz2V+RyuaV+Au82zUMqlbIuXLhw4MABLpfb1taGYVh/f/+SJUsAAGq1GgCgfbDGMKyvr8+Ad2w2293dffbs2UZdtizR0dHl5eU6jUFBQVwuF7ESvUAIVSrVq1ev1Gp1QUEBi8X69u0bhLCxsREA0NXVRayTyZMnnz59evTbhcXRaDQRERHaCzVp0qTm5maydf0BaE8kJiYuWLAAf61Wq8ePH//y5UviXTs7u6qqKqTqTEaj0Zw5cwYAsGjRor179xJnWBThj8sajWbGjBkHDx4kWrZu3Ur8H3r37t2sWbPUajVifSMC3zUpyKCs9PT0JUuW2NjYzJkzZ//+/XijUqmMjIy8detWdXX1mjVramtrydNpEpR1mQEhBAAMDAwQf1a0X2s0moaGhl+/fs2dO5fD4aA7XJgFgzG4OFSDorLMg7IuM8kW8H8B7TIKaJdRQLuMAtplFNAuo4B2GQV/XIYQdnZ2/v79G58kXtCMnkGXxWJxTExMZWVldna2SCRKTk6uqqoa6bzUarVAIEhNTbW0SOsH/kNJAUDV6xhAJpM5OjpeuXKFaNq2bVtwcDAxKZPJsrKyTJzdx48fv379amGNJgMAaG1tpc5wH4GhpMDTp0/T0tK2bNni6upKnkKTsOKkAM7t27cp7jL1kwLMrq6u4OBgQpxIJGKxWEFBQYgOC5YgKytLoVDoNOLDEaToGQoLAODp6UlMV1RUBAQEODg4mDc7pVLJZrPt7OwMf8zNza29vd28nzCR3t5eJtNiZwMsFmtgYMC87xpKCpgBnRQYFkNJATOgkwJ6gXqSAgTUP/pRPynABADY2dl5e3vb2to+evRo3rx5OuN7GIZhGIZ0zY8QJpMpFAq1kwJNTU18Pp9sXX/4M1CGYZi7u/u6detOnDiBt7S0tFy/fl0sFtfX1yclJU2dOnXfvn3kSTUOZcf9DCUFrA5A1TNsI0kB64Ky2zJFZZkHZV2mr+KjgHYZBbTLKKBdRgHtMgpol1FAu4wCOimAAjopgARIJwXGHiM1BcrKympqan7+/CkQCFatWmX4Xn3SawoAAN68eWNlNQWys7Nv376NYZhcLhcIBPHx8eRtDUaw1qRAf3+/h4dHXV0d3v78+XMAgPbtf9TBipMCLBYrJCRk3LhxePukSZMAADKZDMHuNVKonxQAQE9NAR3OnDkzefJknSHBodA1BYbi6uoKvL29z58/jy+8SCSysbE5fPiwjiltbW3u7u5E76EPuVzu4OAwf/58oy5bFgRJgVFiPCnQ2dmZnJx8586dOXPmGF5pdFJAL9BgUqCjo2PHjh0KhQJC2NbW1tjYSNr2oB/qJwX01hSAELa3t69atUokElVXVz9+/DglJeX169fIFZqEtdYUUKlUOscoW1vbgYEBknSaBKDsuR/uYEZGxpMnT7q6uoRCIYZhOTk5dnZ2UqkUUbf1r0MnBVBAUVnmQVmX6av4KKBdRgHtMgpol1FAu4wC2mUU0C6jgE4KoIBOCiAB0kmBscdIUuDOnTtSqVSpVLq7u8fHx9vY2BhYYXRSQC8GkgLHjx/Pzc2FEGIYFhcXt379etI2BmNYa1IAQrhp06adO3fi7adOnbK3tydHozGonxQAQP/TB/D7KfH22NjYuLg4cjQag/pPHzBUU4DBYKhUqvLycpFI5OTkdOrUKaP9D11TYCjGawqMHz/e19c3Jiamvb393r17hmdH1xQYFpNqCri5ubm5uUEIo6Ki+Hy+r6+vPu/opIBeoJ6kwNevX6OjoyUSCb5COjo6AAB5eXmW2DIsjBUnBbq7u52dnZuamvDJ8vLycePGUTONCCmfFDBUUyA/P7+zszMsLEytVqenp+/atSshIQHtnjYyKDvuNygLTwqIxWIvL6/IyMicnBz87W/fvr169YrJZPr4+JhdzAgZVHeZTgqMKRSVZR6UdZm+io8C2mUU0C6jgHYZBbTLKPhHXJbJZMXFxRMnTkxLS7t586ZcLidb0V9YvctisXjp0qU+Pj6FhYUDAwMdHR2XL1/28vJasWJFQ0MD2er+B3GujWHY+/fviSf4UfxRfhBCjUZz6NAhFxeXgoIC/MoksTgqlercuXPOzs5Hjx6lwrX8QVnV1dXR0dEXL17MyMiorKzcs2cP8Yxm01GpVCEhISkpKZYWOTy7d+8ODQ3VvogM/h7D7urqCggIIJ6gTiLWmhQoKCjw8fHRqcEPhiQF5HK5h4fH3bt3EUgygPGnD+CkpqYavXEVonr6wM+fP6dNmzb0Ls+hLkMI79+/z+fzRzPYMXoMJQUI8vPzAZVuBb1x40ZUVNTQ9mFdhhAGBgaa0QFaEGZZWVloaCgxHvrhw4e3b99qD0pJJJLv37+jPigbRCgUrl692vTPr169uqysbMzkGMfI0wdUKtW1a9eodvG+paVlRKOLfD6/paVl7PSYhIGaAtnZ2Z8/f8YHuU3pMShbU2CUma5R1hQwlBQQCoWBgYF4ZQxTQJYUWL58uVAoHNoO9PTLV69eHWWhmrFKCnR3d0skkgMHDpi+0pAlBfz8/GpqaqKiokz8fE1Njb+//1gqMgIDQqhWq9+8eePl5VVUVJSYmKhUKjkcTmVlZUVFBb6nKBSKvLy8/fv3z5s3b8OGDSTKxamtrd24cWNzc7POjjzsWMmvX788PDweP36sHaFCjfa2rVNTgEAikQAAPn36ZPZeY3HCwsLOnj2r0wiG6zEyMzNJT6vqrSlAcOnSpfj4eEdHx6SkpJKSErTy9CKRSHg83rNnz7Qbh7r84MGDKVOmdHR0IJQ2DFb89IGysjIej1daWkq06Lh86dIlHo9XVVWFXJoug7K0j6HknoyOiBcvXvD5/PDw8Js3b+KnThDCvr6+oqKi4OBgf39/IoFGLhS9EcN0+vv7L1y4EBERYW9vz2AwOBwOh8OJjo6+du2aRqMhW90g/wG0fmAvSfAmigAAAABJRU5ErkJggg==%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>$n-$qubit Toffoli gates are very important primitives in quantum computing. For elaboration on this claim I recommend the introduction section in <a href="https://arxiv.org/abs/1508.03273">Maslov's paper</a>, which starts with</p>
<p><em>"Multiple control Toffoli gates are the staple of quantum arithmetic and reversible circuits.  They are employed widely within quantum algorithms, including inreversible transformations, such as arithmetic circuits and all sorts of Boolean operations over quantum registers, as well as subroutines within other specialized quantum transforms."</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Decompositions">
<a class="anchor" href="#Decompositions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Decompositions<a class="anchor-link" href="#Decompositions"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Although there are intriguing recent suggestions to implement multiple-control Toffoli gates directly (see e.g. <a href="https://arxiv.org/abs/2006.07035">here</a>) most hardware platforms currently require them to be decomposed into 1q+2q gates. This is the same what the Classiq problem asked for, to decompose a multiple-controlled Toffoli gate into CNOT gates and arbitrary 1q gates.</p>
<p>I will denote Toffoli gates on $n$ qubits (with $n-1$ controls) by $T^n$ (another frequent notation is $C^{n-1}X$). $T^2$ gate, which is just CNOT, need no further decomposition. $T^3$ gate, the regular Toffoli gate, can be decomposed into CNOT+1q gates as follows.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">ccx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This decomposition has 6 CNOT gates as well as depth 6 with respect to CNOT gates. Total depth is 11. We will be looking for similar decompositions of $T^{n}$ with $n\ge3$. The goal of the Classiq challenge was to find decompositions with the smallest total depth. Other optimization metrics such as CNOT count, CNOT depth or T count and T depth may be preferred for some applications. Here T without a superscript refers to the magic <a href="https://qiskit.org/documentation/stubs/qiskit.circuit.library.TGate.html">T gates</a>, which are important for fault-tolerant circuits. Fortunately, these metrics are not that much decoupled, and a circuit efficient in one respect is also often very efficient in others, see again Maslov's <a href="https://arxiv.org/abs/1508.03273">paper</a> for examples.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Ancilla-qubits">
<a class="anchor" href="#Ancilla-qubits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ancilla qubits<a class="anchor-link" href="#Ancilla-qubits"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As CNOT+1q gates set is universal, it can be used to decompose an arbitrary $n-$qubit gate, including $T^n$. The efficiency of this decomposition can be greatly enhanced if ancilla qubits are provided. Here is an example using a clean ancilla qubit to decompose $T^4$ into three regular Toffoli gates.</p>
<p><figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/toffoli/T4/T4.png" alt="Drawing">
    
    
</figure>
</p>
<p>The first $T^3$ stores $q_0 \land q_1$ in the ancilla qubit. The second $T^3$ combines this with an additional control and applies to the target. The last step is called <em>uncomputation</em>, it is only to restore the state of the ancilla bit to $|0\rangle$ ($T^3$ applied twice is the identity). For a great introduction covering Toffoli gates, their decompositions, various type of ancilla qubits and more see this <a href="https://algassert.com/circuits/2015/06/05/Constructing-Large-Controlled-Nots.html">blog series</a> by Craig Gidney.</p>
<p>As constructed, the circuit for $T^4$ with one clean ancilla uses three $T^3$ and has CNOT count $3\times6=18$. I will now show how this can be compressed using relative phase Toffoli gates.</p>
<p><figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/toffoli/relative_toffoli.png" alt="Drawing">
    
    
</figure>

(The wiggly lines are to emphasize the wave nature of quantum mechanics. Seriously though, the words 'relative phase' remind me of the phase shifts in signal processing, and I had to come up with some pic for this post anyway.)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Relative-phase-Toffoli-gates">
<a class="anchor" href="#Relative-phase-Toffoli-gates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Relative phase Toffoli gates<a class="anchor-link" href="#Relative-phase-Toffoli-gates"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Definition">
<a class="anchor" href="#Definition" aria-hidden="true"><span class="octicon octicon-link"></span></a>Definition<a class="anchor-link" href="#Definition"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Relative phase Toffoli gates $RT^n$ are defined as standard Toffoli gates $T^n$ followed by a diagonal gate $D^n$. I will draw them as follows.</p>
<p><figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/toffoli/RT3/RT3.png" alt="Drawing">
    
    
</figure>
</p>
<p>So, the boxed Toffoli gate stands for the relative phase Toffoli gate. The boxed controlled Z gate (last gate on the right circuit) will be my notation for the diagonal gate itself. Note that this representation is not standard (which I found difficult to typeset), my apologies.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Diagonal-gates">
<a class="anchor" href="#Diagonal-gates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Diagonal gates<a class="anchor-link" href="#Diagonal-gates"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Diagonal gate is just what it sounds, a gate with only diagonal entries. For instance, a general 2q diagonal gate gate be written as $D=e^{\phi_0}|00\rangle\langle00|+e^{\phi_1}|01\rangle\langle01|+e^{\phi_2}|10\rangle\langle10|+e^{\phi_3}|11\rangle\langle11|$. The relative phase Toffoli gate is called that way because its elements only differ from the original Toffoli gate by a phase. Crucially, different elements may differ by different phases (so this is not the irrelevant global phase). Diagonal gates themselves are non-trivial objects. For example, up to a conjugation by two Hadamard gates $n-$qubit Toffoli gate is equivalent to $n-$qubit controlled Z gate, which is diagonal.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Relative-gates-are-shorter">
<a class="anchor" href="#Relative-gates-are-shorter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Relative gates are shorter<a class="anchor-link" href="#Relative-gates-are-shorter"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Why care about the relative phase gates? First, they can have shorter representations compared to the original gates. This might look unreasonable at first, because we are <em>adding</em> an extra diagonal gate. However, the extra gate can <em>cancel</em> part of the original circuit. So, by appending a suitable diagonal gate one can make the relative phase Toffoli gate <em>shorter</em> than the Toffoli gate itself. Here is an example of $RT^3$ gate.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Build circuit</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Store to gate</span>
<span class="n">RT3</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">to_instruction</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'RT3'</span><span class="p">)</span>
<span class="n">RT3dg</span> <span class="o">=</span> <span class="n">RT3</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
<span class="n">RT3dg</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'RT3dg'</span>

<span class="c1"># Draw</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that it only has 3 CNOT gates, while $T^3$ requires 6 gates. Here is a numeric way to check that this gate is indeed $RT^3$.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">is_relative</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">U</span>
    <span class="c1"># If and only if D is unitary and diagonal the check is True.</span>
    <span class="n">check</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">D</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> 
    <span class="k">return</span> <span class="n">check</span>

<span class="c1"># Check that it is indeed the relative phase Toffoli 3 gate</span>
<span class="n">u_RT3</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="n">qc_T3</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc_T3</span><span class="o">.</span><span class="n">ccx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">u_T3</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc_T3</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="c1"># Regular Toffoli gate.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'is RT3:'</span><span class="p">,</span> <span class="n">is_relative</span><span class="p">(</span><span class="n">u_RT3</span><span class="p">,</span> <span class="n">u_T3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>is RT3: True
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Diagonal-gates-commute-with-controls">
<a class="anchor" href="#Diagonal-gates-commute-with-controls" aria-hidden="true"><span class="octicon octicon-link"></span></a>Diagonal gates commute with controls<a class="anchor-link" href="#Diagonal-gates-commute-with-controls"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Second, the relative phase Toffoli gates can be used instead of the standard Toffoli gates in compute-uncompute pairs. For example, $T^4$ with one clean ancilla can be decomposed in the following way.</p>
<p><figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/toffoli/T4_with_RT3/T4_with_RT3.png" alt="Drawing">
    
    
</figure>
</p>
<p>Here the second relative gate should be $(RT^3)^\dagger$ but I leave it implicit in the notation.
OK, but why can we replace $T^3$ by $RT^3$? Because a diagonal gate commutes with a control.</p>
<p><figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/toffoli/D_commute/D_commute.png" alt="Drawing">
    
    
</figure>
</p>
<p>Wires with backslash on them denote a group of several qubits. $U$ can be any operator on $n$ qubits. The diagonal gate can also act on any number of qubits $k+m$. And they can intersect along any number of controls $m$. To show this in full generality would be a bit of a notational mess. Here is the idea though. General diagonal gate can be represented as $D=\sum_n P_n e^{i\phi_n}$ where $P_n=|n\rangle\langle n|$ is the projector on $n-$th basis state. General controlled unitary is $CU = P_0\otimes I+P_1\otimes U$. The matrix $U$ is only applied to the qubits that are not touched by the diagonal gate, therfore $D$ and $CU$ only intersect along wires containing projectors. Since projectors commute, the whole operators also commute. Here is an illustration for the 2q D and $n$-qubit U</p>
<p>
$$\Big[\Big(e^{\phi_0}|00\rangle\langle00|+e^{\phi_1}|01\rangle\langle01|+e^{\phi_2}|10\rangle\langle10|+e^{\phi_3}|11\rangle\langle11|\Big)\otimes I_{n+1}, I_1\otimes |0\rangle\langle0|\otimes I_{n}+I_1\otimes |0\rangle\langle0|\otimes U_n\Big]=0$$
</p>
<p>Since $RT^3$ contains 3 CNOT gates the new construction for $T^4$ now has only 12 CNOT gates, significantly improving on the preceding 18 CNOT decomposition.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Special-relative-phase-gates">
<a class="anchor" href="#Special-relative-phase-gates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Special relative phase gates<a class="anchor-link" href="#Special-relative-phase-gates"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is another version of $RT^3$, known as a <em>special</em> relative phase Toffoli gate $SRT^3$.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Similar to the privious circuit but with an additional CZ gate</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT3</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">decompose</span><span class="p">(</span><span class="s1">'RT3'</span><span class="p">)</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">basis_gates</span><span class="o">=</span><span class="p">[</span><span class="s1">'cx'</span><span class="p">,</span> <span class="s1">'t'</span><span class="p">,</span> <span class="s1">'tdg'</span><span class="p">,</span> <span class="s1">'h'</span><span class="p">],</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">'mpl'</span><span class="p">)</span>

<span class="c1"># Store to gate</span>
<span class="n">SRT3</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">to_instruction</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'SRT3'</span><span class="p">)</span>
<span class="n">SRT3dg</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span><span class="o">.</span><span class="n">to_instruction</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'SRT3dg'</span><span class="p">)</span>

<span class="c1"># Check that it is indeed the relative phase Toffoli 3 gate</span>
<span class="n">u_SRT3</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'is relative:'</span><span class="p">,</span> <span class="n">is_relative</span><span class="p">(</span><span class="n">u_SRT3</span><span class="p">,</span> <span class="n">u_T3</span><span class="p">))</span>

<span class="c1"># Draw</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>is relative: True
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This circuit has one more CNOT gate than $RT^3$ defined above. A special feature of this gate (and the reason it is called special) is that the diagonal gate has a restricted form -- it only acts on the first two qubits, graphically</p>
<p><figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/toffoli/SRT3/SRT3.png" alt="Drawing">
    
    
</figure>
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="$RT^4$">
<a class="anchor" href="#%24RT%5E4%24" aria-hidden="true"><span class="octicon octicon-link"></span></a>$RT^4$<a class="anchor-link" href="#%24RT%5E4%24"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As suggested by Maslov, this gate can be used to construct $RT^4$ out of $RT^3$. Indeed, take a look at the following circuit.</p>
<p><figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/toffoli/RT4/RT4.png" alt="Drawing">
    
    
</figure>
</p>
<p>It is obtained from $RT^3$ by adding an extra qubit and replacing the middle CNOT with $SRT^3$. Why does this work? The new circuit must (1) do what the 3q circuit did when the state of $q_0$ is $|1\rangle$ and (2) do nothing if the state of $q_0$ is $|0\rangle$.  When the new qubit is in state $|1\rangle$, the $RT^3$ gate behaves just like a CNOT between $q_1$ and $q_3$ and we are back to the 3q circuit behavior. When the new qubit is $|0\rangle$, the $RT^3$ gate becomes 3q identity, and all gates around it cancel in pairs, so the whole circuit is 4q identity. Good. Finally, the additional diagonal gate acting on $q_0, q_1$ can be moved to the right and combined with the diagonal gate defining $RT^3$. Note that if we inserted $RT^3$ instead of $SRT^3$ in the middle, this wouldn't work because 3q diagonal gate would not commute with gates on qubit $q_3$. This implementation of $RT^4$ has 6 CNOT gates, which is apparently the optimal result.</p>
<p>Here is an explicit implementation.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Build circuit</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SRT3</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">decompose</span><span class="p">(</span><span class="s1">'SRT3'</span><span class="p">)</span>

<span class="c1"># Store to gate</span>
<span class="n">RT4</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">to_instruction</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'RT4'</span><span class="p">)</span>
<span class="n">RT4dg</span> <span class="o">=</span> <span class="n">RT4</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
<span class="n">RT4dg</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'RT4dg'</span>

<span class="c1"># Check that it is indeed the relative phase Toffoli 3 gate</span>
<span class="n">u_RT4</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="n">qc_T4</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc_T4</span><span class="o">.</span><span class="n">mct</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">u_T4</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc_T4</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'is relative:'</span><span class="p">,</span> <span class="n">is_relative</span><span class="p">(</span><span class="n">u_RT4</span><span class="p">,</span> <span class="n">u_T4</span><span class="p">))</span>

<span class="c1"># Draw</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>is relative: True
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="$RT^5$">
<a class="anchor" href="#%24RT%5E5%24" aria-hidden="true"><span class="octicon octicon-link"></span></a>$RT^5$<a class="anchor-link" href="#%24RT%5E5%24"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The final ingredient I will need is $RT^5$. It is not present in Maslov's paper and I haven't found it with a brief search in other literature, but we can use the same idea to build $RT^5$ out of $RT^4$ and $SRT^3$. Namely, in the diagram above we replace both CNOTs acting between $q_0$ and $q_3$ by $SRT^3$. This leads to the following circuit.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Build circuit</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SRT3dg</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SRT3</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">qc</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">decompose</span><span class="p">(</span><span class="s1">'RT3'</span><span class="p">)</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">basis_gates</span><span class="o">=</span><span class="p">[</span><span class="s1">'cx'</span><span class="p">,</span> <span class="s1">'t'</span><span class="p">,</span> <span class="s1">'tdg'</span><span class="p">,</span> <span class="s1">'h'</span><span class="p">],</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Check that it is indeed the relative phase Toffoli 3 gate</span>
<span class="n">u_RT5</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="n">qc_T5</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">qc_T5</span><span class="o">.</span><span class="n">mct</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">u_T5</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc_T5</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'is relative:'</span><span class="p">,</span> <span class="n">is_relative</span><span class="p">(</span><span class="n">u_RT5</span><span class="p">,</span> <span class="n">u_T5</span><span class="p">))</span>

<span class="c1"># Draw</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>is relative: True
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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mzdvXr9+3cPDw2g0iqJYVFQkimJQUNDt27evXr3q6elpvTdwUVFRUVFRcHCwE0K6c+fOA1fijUaj0qsA33zzzezZs9PT07t3726xWDIzM7dt2zZ58uRWrVpFR0e3bt1a0d7L65lnnomMjBw6dKgzO9Vg8UikzT3SwhGRkpIyc+bMlJSUbt26VatWraioKD4+fvr06fXr1583b16PHj2U67pinHZEmM3mVatWxcTEeHl5hYWFCYJw4cKFffv2jRo1atiwYW+++WZgYKByvWuhNgoLC2NjY9955x1vb+/27duLonj+/Pn4+PiRI0eOHDly7ty5WlvXcOZsefny5blz5+7YsaNdu3bBwcEWi+XQoUMxMTGFhYWzZs0aO3ascteF2pzNpNBCtYuiuHnz5v/5n//Jz8/v3LmzKIqXLl367rvvxo0b16dPn7fffrtBgwbK9V4BqlwbSKSd0lXxOlAL1S4IwldffTV79uzLly93795dFMXMzMz//d//ff7559u2bRsdHa21z5ycWe137tx5//33lyxZUq9evVatWomiePr06Y0bN549e/bZZ5+dMWOGoh/eaKE8bt26tWjRoqVLlwYHBz/xxBOiKP7000/r1q1LS0ubPHnyq6++Wr16deV6rwB+UZKFFmpPEIRdu3bNnTv3xo0bERERFovlypUrP/3004QJE7p06WL9AFXR3suL2iumhfrJy8t79913P/744yZNmjz++OPWb9vExsZeunTpxRdffOmll7T2VRvqpyLE/7JYLL/++mt+fr71ZfE/NKhk2MXOnTtXvNRSvXr1GTNmrFq1ShTFixcvzps3r0+fPoIgVKlS5dVXX12+fLmDbUoMyd/f38PD4x//+Mfo0aMjIyOtw9+4ceOJEyc+9dRTPXr0MJlMDRs2dLzB8iosLHzhhRcaNmy4bds2a2kWN1tQULBy5crAwMDo6GiLxSK9L1kCFkVx9OjRX3/9taJ93f/jEotHYkhK1J4GDwdRwhEhS3VZLJaYmJjAwMDY2NiCgoKSLRcVFW3fvr1hw4ZTpkwpLCyU3pdch4PowBEhS1/Xr1/v1KlTt27dUlJSSjWbnZ39+uuv+/v779mzR3pHsteGnTbL5erVq2FhYT179jxx4kSpZm/cuPHqq68GBAR888030jtyZm3I1d0XX3zh5+c3a9as3NzcUs1+//33nTt37tat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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Subcircuits between barriers are the inserted $SRT^3$ gates. This circuit has 12 CNOT gates. Apparently, by looking at it carefully enough one can find a pair of CNOT gates that cancel each other. I stumbled upon this fact by accident. I tried to substitute shorter $RT^3$ instead of $SRT^3$ here and was sure it would fail, but it worked. The resulting decomposition of $RT^5$ has only 10 CNOT gates. Here is the circuit.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Build circuit</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT3</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT3</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">qc</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">decompose</span><span class="p">(</span><span class="s1">'RT3'</span><span class="p">)</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">basis_gates</span><span class="o">=</span><span class="p">[</span><span class="s1">'cx'</span><span class="p">,</span> <span class="s1">'t'</span><span class="p">,</span> <span class="s1">'tdg'</span><span class="p">,</span> <span class="s1">'h'</span><span class="p">],</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Store to gate</span>
<span class="n">RT5</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">to_instruction</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'RT5'</span><span class="p">)</span>
<span class="n">RT5dg</span> <span class="o">=</span> <span class="n">RT5</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
<span class="n">RT5dg</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'RT5dg'</span>


<span class="c1"># Check that it is indeed the relative phase Toffoli 3 gate</span>
<span class="n">u_RT5</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="n">qc_T5</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">qc_T5</span><span class="o">.</span><span class="n">mct</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">u_T5</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc_T5</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'is relative:'</span><span class="p">,</span> <span class="n">is_relative</span><span class="p">(</span><span class="n">u_RT5</span><span class="p">,</span> <span class="n">u_T5</span><span class="p">))</span>

<span class="c1"># Draw</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>is relative: True
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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dMSIEYIgODk5LViw4JNPPjGyTjND8vDwcHBwGDp06JQpU2bMmBEQECAIQteuXZ977rmnn356yJAhKpUqMDDQ+Aqbqrq6+qWXXgoMDNy5c+edO3f0q62qqlq/fr23t3dsbKxWqzW/LUkCFkVxypQp33//vUXbUubOKi4uHjFiRHh4eGpqap1qb926tXTpUrVa/c9//tP8hkSb2lk6qampXl5es2fPvn79ep1qT506NWrUqAcffFB3hmCmxqKVPT0OHDjg6ek5b968P/74o061J0+ejIyMDAsLy83NNb8hqXJDNCI9LPFGZiKor7q6+pVXXuncufOOHTvqTwQbNmy47777li1bxkRgZvKYGZJiB59z584FBwdPmDBB9wmBfrU5OTnPP/+8r6+vbvXKTDY0+NRav369Wq1+7733ysrK6tSclJTUq1evCRMm3L592/yGJE8PqXrgk08+UavVq1evLi8v169Zq9UmJib26NFjypQptf9kDhtKD6WNLY09XfaxpaioaNiwYf37909PT69T7c2bN9966y21Wr1r1y7zGxJtZ26ylQMbUQH5k5yc7OnpuWDBghs3btSp9pdffhk2bFhERMS1a9fMb8imBx9R7vwx059tp6WljRo1auPGjUuWLNm/f/+LL76YnJzc1LoqKioefvjhl19+Weog6zLQZbqvCI0aNarO9tOnTwuCMGjQIBPqNC0krVbbvn173RcfdN5//31BENauXVu7JTMzU61WWyIenalTp0ZGRt68ebOxanNzc3v37v3GG2+Y31aDAd++fbv0bmoP73SWLFly6dIlE9oyJ1TZd1Z5eXlYWNhLL71UXV3dWLX//ve/O3XqlJCQYGZb9WvWUebOEkXx8OHDarX6u+++M1Dte++95+/vn5+fb2ZbDUYre3r88MMParU6JSWlsWq1Wm1sbGxgYGBBQYGZbTUWrSXSw0IHTyITwf/vmWeeGTZsWHFxcWPVXrt2LSwsLDo62vy2bGhsaezpJiePmSEpc/C5dOmSt7f3p59+aqDaXbt2qdXqX3/91cy2bGjw0fnkk0+6dOly5syZxmquqKj429/+NmTIEP2Z3TSSp4ckPfDhhx8GBQXpvsjQYM3l5eWTJk0aOXKk7qbp5rCh9FDa2NLg02UfW8rKynr37j179mz93KhT7YkTJzp27Lhz504z26pfs44C5yabOLAR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glofffTR22+//eOPPxoutm/fvo0bN77zzjvWiequSJ7GWDN/unbt+uKLL44bN07XaGPu3Lkzbdq0IUOGGHOJUuuwQv5ER0cfP348Li7OcLELFy4899xzcXFx1vl4yZrpsXjx4tTU1Pj4eMPFTp8+HRUVFRcXp5wbOss1vDC21HJxcVmzZs3EiROvXbtmuOSyZctKSkr+53/+xwpRGYO5qTHWzJ+JEye6u7vPmTPHcLGbN2+OHTs2NjbW+MttWxr502S6q1W9+eabgwYNatWqVffu3efOnWvORbOsQGjosl7Hjx//29/+1qdPn3bt2rm5uU2aNCkmJkYUxVOnTj3zzDP9+vVr165d+/btJ0yYsGDBAiPrNDMknX379s2YMeOpp57q2LFju3btOnXqNHny5BkzZqSkpJhWofG+/fZbtVq9Y8eOBqvVarUff/yxp6fnsWPHzG/LmIBXr14tCEJcXJwV2jLt6TLurA8++KBTp05HjhxpsNqKioq5c+dqNJqrV6+a35YN7SxRFEtLS/v37z9+/Pji4uIGqz137tz9998/a9YsMxsS7xatXOlx69atsLCwyZMn37p1q8FqT58+3b1798Yu7tskRkYrSXpY4o3MRFBfYmKiWq3evn17g9Vqtdq4uDhPT8+ffvrJ/LZsaGyp/3Qzk8fMkJQ5+Gi12qlTp/br1+/y5csNVnvjxo0RI0ZERkaac6na+tUaoITBR+fcuXOdOnV666239C8Wq19zSkqKt7f3xo0bzW9L8vSQpAdOnz7t4+OzfPnympqaBmtOSkry9PTctm2b+W3ZUHoobWwx/HQZ56ZVq1b5+fnpn4PoV1teXj579uzg4OBr166Z35atzE22dWAjypc/xcXFvXv3njp1aklJSYPVZmVlBQcHL1y40MyGRBsffES588dMf7atP8uac3l267BEl1n0bSxjhT///HNwcPDgwYN37Nihu72jKIr5+flbtmzp3bt3v379zp8/L0lDxgSs+7j+ww8/tEJblnu65SrcvXu3t7f35MmTk5KSysvLddVmZ2f/3//9n7+//7hx4xq8SYoJbGhn6VRUVLz00kseHh7Lli3LysrSXVy8qqoqPT39pZdecnNzW7t2rfmtiIocW3TKy8uff/55T0/PFStWnD59urYHUlNTX3jhBXd393Xr1pnfimh0tJKkh9LeyObXqdix5fjx4926dXv00Uf/+c9/1k4Ef/zxx9atW/v06RMWFnbu3DlJGrKhsUVp+aO0eGpptdqVK1e6ubnNnTtXd8sdQRDu3Llz8uTJmJgYd3f3hQsXSnLcaEODT628vLzhw4cHBQXFxcXl5OToai4tLd27d+/YsWN9fX2Tk5MlaUixY8vVq1eHDBnSrVu3zz77TPdBmq4H9uzZM2bMGH9//4MHD0rSkA2lhwLfy4rNn507d3p5eU2ZMuX777+vPe79/fffV69e7evrO3HiRP1PKM1hK3NTS0geqeosKyubOXOml5fXO++8c+bMGV21lZWVP/zww/PPP69Wq+Pj481vRWTwkXWhyk602L0MLcfOTvqwzaxT8pAkrLCmpubzzz/fvn17WlpaaWmpg4ODs7Pzo48++vTTTz/++ON2dnaStGIg4MTExJ07d5aXl6emppaUlLRr1+6hhx5ycnKaMmXKI488Im1bVni6RSssLS397LPPdu3adfz48crKylatWrm5uUVGRs6YMUPCC6jb0M7Sl5mZGRcXt2/fvpycnOrqat03QB977LGoqCipvkmrwLFF36+//vrpp58mJiZevXpV1wM9evR4/PHHX3zxRamuzmg4WmnTQ2lvZPPrVPLYcufOnS+++CIhISE1NbW0tNTR0dHJyWnw4MGTJ08eO3YsE4EkzKlTafHUcfXq1bVr1+7Zs+fs2bO6wcfPz2/UqFEvvvhiYGCgJE3Y0OBTR3Jy8qZNm5KTk4uKiqqrq52cnPr16zdu3LgZM2ZIdYMnJY8tgiB89913mzdvTk5OvnXrVlVVVevWrcPDw8eNGzd9+nRHR0dJmrCh9FDge1nJ+VNaWvrpp5/qjnurqqpatWrl7u4eGRk5c+bM8PBwSZoQbGduagnJI22dJ0+e1B0Y5+bm6uamnj176g6M/+u//kuSJhh8ZFwsYqFKmjqVPAfoKyoqUqlUbdq0kbxma+ZxC9lZ169fv/fee6U6yNNnQzurQdXV1QUFBR4eHlKdXddS4NjSIF0PWOKKjDaUGwrcWbYytjARmP90yetUWjyN0Wq1+fn5bm5ukl90yYaSpzHl5eUlJSVqtVrymm1lbCkrKysrK7PEFWFsKD0U+F62lfzhuLclJI+F6uTA2PynW63OJrTOQpUkddrKHGA5LfltzM5SSFvmU+DYYmU2lBsK3FmMLeRPczo/sTIbSh7rY2yxofRQ4HuZ/LGV/GkJyWOhOi3HVpLH/KdbrU7jKeJmnwAAAAAAAAALVQAAAAAAAFAEiS8xYB0qlUrya9OYebUFyUOS/OoPqMXOQmMUOLagMQrcWYwtNkRp+aO0eKAojC02RIHvZfLHVrSE5BHIH4tpfjvLln4jCiWzoV/wgp2FxpAbMAf5A5ORPDCA9IA5yB+YjOSRESuakIYlFnENtGWdhpordhYaQ27AHOQPTEbywADSA+Ygf2AykkdG/w+WVM4vG4CFhQAAAABJRU5ErkJggg==%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Generalization-of-relative-phase-gates">
<a class="anchor" href="#Generalization-of-relative-phase-gates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generalization of relative phase gates<a class="anchor-link" href="#Generalization-of-relative-phase-gates"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is possible to further generalize relative phase gates by allowing more general operators which cancel in compute-uncompute pairs. See Maslov's paper for the use of more general gates with dirty ancilla qubits.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Solution-to-the-Classiq-problem">
<a class="anchor" href="#Solution-to-the-Classiq-problem" aria-hidden="true"><span class="octicon octicon-link"></span></a>Solution to the Classiq problem<a class="anchor-link" href="#Solution-to-the-Classiq-problem"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now all of the ingredients are in place. The original problem statement is <a href="https://www.classiq.io/competition/toffoli">here</a>. One needs to decompose a Toffoli gate with 14 controls and one target using no more than 5 clean ancilla qubits, 20 qubits in total. The ancilla must be returned into original state. Best solution is the one with the smallest depth. Here is my solution.</p>
<p><figure>
  
    <img class="docimage" src="/blog/images/copied_from_nb/myimages/toffoli/T15/T15.png" alt="Drawing">
    
    
</figure>
</p>
<p>The intuition is a follows. Having the smallest depth means that we need to perform as many operations in parallel as possible. The first layer in the circuit divides the 14 control qubits into four groups $14=4+4+3+3$, and stores their logical ANDs in four of the available ancilla qubits. It remains to compute the logical AND of these four ancilla and write it to the target qubit, i.e. to perform $T^5$ gate. To make this operation efficient we have one more clean ancilla available. Layers 2, 3 and 4 thus perform $T^5$ gate with the use of the last clean ancilla. The very last layer uncomputes the first. This circuit works if all of the gates used are plain Toffoli gates. However, using relative phase Toffoli gates in compute-uncompute pairs significantly reduces the depth.</p>
<p>The expected CNOT depth is $38=2\times 10+2\times 6+6$, where $10$ is the depth of $RT^5$, 6 of $RT^4$ and the last 6 is the depth of $T^3$. The 1q depth should be about twice as much. Note that by the rules of the competition general single-qubit gates can be used, which means that, say, $H$ and $T$ gates can be combined together and count as a single gate.</p>
<p>After using <code>qiskit</code> transpiler the final CNOT and total depth of the circuit are a bit smaller than estimated above. I am not sure where the optimization comes from, but many thanks to the transpiler! Here is a complete solution coded in <code>qiskit</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c41</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'c41'</span><span class="p">)</span>
<span class="n">c42</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'c42'</span><span class="p">)</span>
<span class="n">c31</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'c31'</span><span class="p">)</span>
<span class="n">c32</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'c32'</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'a</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'trgt'</span><span class="p">)</span>

<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">c41</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c42</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c31</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">c32</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">t</span><span class="p">)</span>

<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT5</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT5</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">18</span><span class="p">)))</span>

<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">18</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">ccx</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4dg</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">18</span><span class="p">])</span>

<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT5dg</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT5dg</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4dg</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4dg</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">18</span><span class="p">)))</span>

<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<pre style='word-wrap: normal;white-space: pre;background: #fff0;line-height: 1.1;font-family: "Courier New",Courier,monospace'>       ┌──────┐                       ┌────────┐
c41_0: ┤0     ├───────────────────────┤0       ├
       │      │                       │        │
c41_1: ┤1     ├───────────────────────┤1       ├
       │      │                       │        │
c41_2: ┤2 RT5 ├───────────────────────┤2 RT5dg ├
       │      │                       │        │
c41_3: ┤3     ├───────────────────────┤3       ├
       │      │┌──────┐     ┌────────┐│        │
   a1: ┤4     ├┤0     ├─────┤0       ├┤4       ├
       ├──────┤│      │     │        │├────────┤
c42_0: ┤0     ├┤      ├─────┤        ├┤0       ├
       │      ││      │     │        ││        │
c42_1: ┤1     ├┤      ├─────┤        ├┤1       ├
       │      ││      │     │        ││        │
c42_2: ┤2 RT5 ├┤      ├─────┤        ├┤2 RT5dg ├
       │      ││      │     │        ││        │
c42_3: ┤3     ├┤      ├─────┤        ├┤3       ├
       │      ││      │     │        ││        │
   a2: ┤4     ├┤1     ├─────┤1       ├┤4       ├
       ├──────┤│      │     │        │├────────┤
c31_0: ┤0     ├┤      ├─────┤        ├┤0       ├
       │      ││      │     │        ││        │
c31_1: ┤1     ├┤  RT4 ├─────┤  RT4dg ├┤1       ├
       │  RT4 ││      │     │        ││  RT4dg │
c31_2: ┤2     ├┤      ├─────┤        ├┤2       ├
       │      ││      │     │        ││        │
   a3: ┤3     ├┤2     ├─────┤2       ├┤3       ├
       ├──────┤│      │     │        │├────────┤
c32_0: ┤0     ├┤      ├─────┤        ├┤0       ├
       │      ││      │     │        ││        │
c32_1: ┤1     ├┤      ├─────┤        ├┤1       ├
       │  RT4 ││      │     │        ││  RT4dg │
c32_2: ┤2     ├┤      ├─────┤        ├┤2       ├
       │      ││      │     │        ││        │
   a4: ┤3     ├┤      ├──■──┤        ├┤3       ├
       └──────┘│      │  │  │        │└────────┘
   a5: ────────┤3     ├──■──┤3       ├──────────
               └──────┘┌─┴─┐└────────┘          
 trgt: ────────────────┤ X ├────────────────────
                       └───┘                    </pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The CNOT and overall depth of the circuit can be computed as follows.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qc_final</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">basis_gates</span><span class="o">=</span><span class="p">[</span><span class="s1">'cx'</span><span class="p">,</span> <span class="s1">'u'</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'total depth:'</span><span class="p">,</span> <span class="n">qc_final</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'CX depth:'</span><span class="p">,</span> <span class="n">qc_final</span><span class="o">.</span><span class="n">depth</span><span class="p">(</span><span class="k">lambda</span> <span class="n">gate</span><span class="p">:</span> <span class="n">gate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">'cx'</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>total depth: 70
CX depth: 36
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is of course possible to use other ways of splitting the control qubits into groups and/or using the ancilla qubits differently. I'm really curious to look at solutions submitted by other participants, including the best one due to Soshun Naito. Looking forward to Classiq announcement!</p>
<p><strong><em>Update</em></strong>: As noted by <a href="https://www.linkedin.com/in/gramolin/">Alexander Gramolin</a>, this decomposition can be improved by using an upgraded version of the Toffoli 3 gate sitting in the middle of the circuit. My implementation above uses standard <code>qiskit</code> decomposition with depth 11. A better option is to use depth-8 Toffoli gate from <a href="https://arxiv.org/abs/1206.0758">this paper</a> (be sure Dmitri Maslov if one of the authors:):</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Build circuit</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">tdg</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Store to gate</span>
<span class="n">T3</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">to_instruction</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'T3'</span><span class="p">)</span>

<span class="c1"># Check that it is indeed the relative phase Toffoli 3 gate</span>
<span class="n">u_T3</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="n">qc_T3_standard</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qc_T3_standard</span><span class="o">.</span><span class="n">ccx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">u_T3_standard</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">qc_T3_standard</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'is T3:'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">u_T3</span><span class="p">,</span> <span class="n">u_T3_standard</span><span class="p">))</span>

<span class="c1"># Draw</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>is T3: True
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This reduces $CX$ depth by 1 and total depth by 4!</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c41</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'c41'</span><span class="p">)</span>
<span class="n">c42</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'c42'</span><span class="p">)</span>
<span class="n">c31</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'c31'</span><span class="p">)</span>
<span class="n">c32</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'c32'</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'a</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'trgt'</span><span class="p">)</span>

<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">c41</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c42</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c31</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">c32</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">t</span><span class="p">)</span>

<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT5</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT5</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">18</span><span class="p">)))</span>

<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">18</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T3</span><span class="p">,</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4dg</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">18</span><span class="p">])</span>

<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT5dg</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT5dg</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4dg</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">)))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RT4dg</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">18</span><span class="p">)))</span>

<span class="n">qc_final</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">basis_gates</span><span class="o">=</span><span class="p">[</span><span class="s1">'cx'</span><span class="p">,</span> <span class="s1">'u'</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'total depth:'</span><span class="p">,</span> <span class="n">qc_final</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'CX depth:'</span><span class="p">,</span> <span class="n">qc_final</span><span class="o">.</span><span class="n">depth</span><span class="p">(</span><span class="k">lambda</span> <span class="n">gate</span><span class="p">:</span> <span class="n">gate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">'cx'</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>total depth: 66
CX depth: 35
</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>

<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script>



<script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       processEscapes: true
     }
   });
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="idnm/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/compilation/paper%20review/2022/06/21/Classiq-Toffoli.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>My take on various quantum concepts and brief reviews of latest research papers</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="/feed.xml" target="_blank" title="rss">
    <svg class="svg-icon grey">
      <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://github.com/idnm/" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/blog/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.linkedin.com/in/nikita-nemkov/" target="_blank" title="linkedin">
    <svg class="svg-icon grey">
      <use xlink:href="/blog/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
